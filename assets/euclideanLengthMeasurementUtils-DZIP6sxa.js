const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SelfSnappingEngine-CNEP73tc.js","assets/index-B9VIL3e7.js","assets/index-ClKQjglF.css","assets/angularMeasurementUtils-C1bqKYEZ.js","assets/geometry2dUtils-Do_IgdQW.js","assets/utils-BJyoDuBg.js","assets/geodeticLengthOperator-CbjYMCl8.js","assets/geodeticCurveType-CirnHLSB.js","assets/GridSnappingEngine-Bc_5-3OS.js","assets/FeatureSnappingEngine-BVfkHAmT.js"])))=>i.map(i=>d[i]);
import{a9 as Ke,ae as xt,e as d,m as p,h as Rt,bx as Be,ac as Zt,bl as Bn,fM as Xn,w4 as Yn,eu as yt,A7 as Xe,A8 as Ye,aD as Et,cH as Ft,yJ as Qn,an as ve,ar as Qe,A9 as je,nN as ts,ec as me,bw as es,iO as ns,Aa as ss,qU as is,s as Tt,fb as tn,g3 as rs,Ab as N,Ac as as,Ad as os,V as en,d0 as Se,i3 as us,aC as nn,P as cs,cA as ls,lL as Pt,dd as lt,dh as hs,de as Ht,aU as y,cO as O,eb as A,f1 as L,aJ as ht,df as ft,dH as Wt,Ae as $e,ld as ot,Af as ds,di as Bt,cI as Xt,dj as Gt,er as Yt,Ag as _e,Ah as sn,cK as xe,y3 as rn,l7 as Mt,tX as It,sl as ps,ep as F,jf as an,pP as fs,y1 as gs,eA as S,jK as ys,vW as vs,cw as ms,Ai as $s,Aj as _s,nR as ws,y2 as on,eq as un,lF as cn,fL as bs,jM as Ss,l8 as xs,Ak as Ms,Al as Ts,xy as Ps,Am as Rs,dI as Es,An as Oe,q$ as Ls,Ao as zs,aK as qs,mJ as Ns,sh as ks,mE as As,mF as ln,mO as Ds,ee as js,cz as Lt,sa as Z,bO as Os,cD as Cs,ao as Hs,_ as ae,c as oe,hw as Ce,hv as Is,bK as Vs,kl as Zs,km as Fs,g4 as Ws,kb as Gs,Ap as Us,kn as Js,yI as Ks,yH as hn,cc as ue}from"./index-B9VIL3e7.js";import{r as Bs}from"./utils-BJyoDuBg.js";import{g as Xs}from"./geometry2dUtils-Do_IgdQW.js";import{m as Ys,l as dn}from"./geodeticLengthOperator-CbjYMCl8.js";let at=class extends Ke{constructor(t){super(t),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new xt}};d([p({constructOnly:!0})],at.prototype,"layer",void 0),d([p()],at.prototype,"enabled",void 0),d([p()],at.prototype,"updating",void 0),d([p()],at.prototype,"availability",void 0),d([p()],at.prototype,"sublayerSources",void 0),at=d([Rt("esri.views.interactive.snapping.FeatureSnappingLayerSource")],at);let J=class extends Be{constructor(){super(...arguments),this.enabled=!0}};d([p({type:Boolean})],J.prototype,"enabled",void 0),J=d([Rt("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],J);let w=class extends Be{constructor(t){super(t),this.lineSnapper=new J,this.parallelLineSnapper=new J,this.rightAngleSnapper=new J,this.rightAngleTriangleSnapper=new J,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Zt([255,127,0]),this.orangeTransparent=new Zt([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};d([p({type:J,constructOnly:!0,nonNullable:!0,json:{write:!0}})],w.prototype,"lineSnapper",void 0),d([p({type:J,constructOnly:!0,nonNullable:!0,json:{write:!0}})],w.prototype,"parallelLineSnapper",void 0),d([p({type:J,constructOnly:!0,nonNullable:!0,json:{write:!0}})],w.prototype,"rightAngleSnapper",void 0),d([p({type:J,constructOnly:!0,nonNullable:!0,json:{write:!0}})],w.prototype,"rightAngleTriangleSnapper",void 0),d([p({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],w.prototype,"shortLineThreshold",void 0),d([p({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],w.prototype,"distance",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],w.prototype,"pointThreshold",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],w.prototype,"intersectionParallelLineThreshold",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],w.prototype,"parallelLineThreshold",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],w.prototype,"verticalLineThresholdMeters",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],w.prototype,"touchSensitivityMultiplier",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],w.prototype,"pointOnLineThreshold",void 0),d([p({type:Zt,nonNullable:!0})],w.prototype,"orange",void 0),d([p({type:Zt,nonNullable:!0})],w.prototype,"orangeTransparent",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],w.prototype,"lineHintWidthReference",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],w.prototype,"lineHintWidthTarget",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],w.prototype,"lineHintFadedExtensions",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],w.prototype,"parallelLineHintWidth",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],w.prototype,"parallelLineHintLength",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],w.prototype,"parallelLineHintOffset",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],w.prototype,"rightAngleHintSize",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],w.prototype,"rightAngleHintOutlineSize",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],w.prototype,"satisfiesConstraintScreenThreshold",void 0),w=d([Rt("esri.views.interactive.snapping.Settings.Defaults")],w);const Ut=new w;let R=class extends Ke{constructor(t){super(t),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new xt,this.distance=Ut.distance,this.touchSensitivityMultiplier=Ut.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const t=this.featureSources;t.some(He)&&Bn.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const n=t.filter(ti),s=this._get("_effectiveFeatureSources")?.filter(He)??new xt;for(const u of n){const c=s.find(l=>l.layer===u.layer.parent);if(c)c.sublayerSources.includes(u)||c.sublayerSources.add(u);else if(u.layer.parent){const l=new at({layer:u.layer.parent});l.sublayerSources.add(u),s.add(l)}}for(const u of s){const c=u.sublayerSources.filter(l=>!n.includes(l));u.sublayerSources.removeMany(c)}s.removeMany(s.filter(u=>u.sublayerSources.length===0));const i=t.filter(Qs),r=this._get("_effectiveFeatureSources")??new xt,{added:a,removed:o}=Xn(r.toArray(),[...i,...s]);return r.removeMany(o),r.addMany(a),r}};function He(e){return e.layer.type==="subtype-group"}function Qs(e){return e.layer.type!=="subtype-group"}function ti(e){return e.layer.type==="subtype-sublayer"}d([p()],R.prototype,"enabled",void 0),d([p()],R.prototype,"enabledToggled",void 0),d([p()],R.prototype,"forceDisabled",void 0),d([p()],R.prototype,"selfEnabled",void 0),d([p()],R.prototype,"featureEnabled",void 0),d([p()],R.prototype,"gridEnabled",void 0),d([p()],R.prototype,"attributeRulesEnabled",void 0),d([p({type:xt.ofType(at)})],R.prototype,"featureSources",void 0),d([p()],R.prototype,"distance",void 0),d([p()],R.prototype,"touchSensitivityMultiplier",void 0),d([p({readOnly:!0})],R.prototype,"effectiveEnabled",null),d([p({readOnly:!0})],R.prototype,"effectiveGridEnabled",null),d([p({readOnly:!0})],R.prototype,"effectiveSelfEnabled",null),d([p({readOnly:!0})],R.prototype,"effectiveFeatureEnabled",null),d([p({readOnly:!0})],R.prototype,"_effectiveFeatureSources",null),R=d([Rt("esri.views.interactive.snapping.SnappingOptions")],R);function pn(e,t,n){return C(e,t,n)}function C(e=0,t=0,n=0){return Ft(e,t,n)}function Rr(e){return e}function Er(e){return e}function dt(e,t,n){return Ft(e,t,n)}function vt(e){const[t,n,s]=e;return e.length>3?[t,n,s,e[3]]:[t,n,s]}function ce(e){return e[3]=1|((e.length>3?e[3]:void 0)??0),e}function Lr(e){return!!(1&((e.length>3?e[3]:void 0)??0))}function Ie(e,t,{coordinateHelper:n,elevationInfo:s},i){return e?St(n.vectorToDehydratedPoint(e,ei),t,s,i):null}function St(e,t,n,s=C()){return s[0]=e.x,s[1]=e.y,s[2]=e.z??0,t==null||(t.type==="2d"?s[2]=0:s[2]=Yn(t,e,n,yt)??0),s}function zr(e,t,n){return n?(Ye(n,e[0],e[1],e[2],t),n):Et(e[0],e[1],e[2],t)}function Ve(e,t,{z:n,m:s},i,r){const{spatialReference:a,elevationInfo:o}=i;let u;n==null&&s==null?u=void 0:t==null||t.type==="2d"?u=n??void 0:u=Xe(t,e,a,yt,o)??0;const[c,l]=e;return r?Ye(r,c,l,u,a):r=Et(c,l,u,a),s!=null&&(r.m=s,r.hasM=!0),r}function qr(e,t,n,s,i=C()){const[r,a]=e;return i[0]=r,i[1]=a,e.length>3&&(i[3]=e[3]??0),n?.type!=="3d"?(i[2]=t.value,i):(i[2]=Qn(n,r,a,t.value,s,t.elevationInfo,yt)??0,i)}const ei=Et(0,0,0,null),Nr=Symbol("grid-placement-graphic");function fn(e,t){const n=e.x-t.x,s=e.y-t.y;return n*n+s*s}function kr(e,t){return Math.sqrt(fn(e,t))}function ni(e,t){t.sort((n,s)=>me(n.targetPoint,e)-me(s.targetPoint,e))}function Ar({parameters:{point:e,distance:t,returnEdge:n,vertexMode:s,coordinateHelper:{spatialReference:i},filter:r},mode:a,returnZ:o,filter:u}){const c=u?.clone()??new es({where:"1=1"});return c.returnZ=o??a==="3d",r&&(c.geometry=r.geometry,c.distance=r.distance,c.spatialRelationship=r.spatialRelationship,c.where=ns(c.where,r.where),c.timeExtent=ss(c.timeExtent,r.timeExtent),c.objectIds=si(c.objectIds,r.objectIds)),{point:Et(e[0],e[1],e[2],i.toJSON()),mode:a,distance:t,returnEdge:n,vertexMode:s,query:c.toJSON()}}function si(e,t){return e||t?t?e?Array.from(is(new Set(e),new Set(t))):t:e:null}function Dr(e,t,n){return{left:Ie(e.leftVertex.pos,t,n),right:Ie(e.rightVertex.pos,t,n)}}const Ze=Symbol("snapping-toggle");function jr(e,t=()=>{}){const n=ve(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:s,snappingOptions:i})=>{if(e.removeHandles(Ze),!s||!i)return;const r=ts.TOOL,a=[s.on("key-down",o=>{o.key!==je.toggle||o.repeat||(i.enabledToggled=!0,t())},r),s.on("key-up",o=>{o.key===je.toggle&&(i.enabledToggled=!1,t())},r),s.on("pointer-move",o=>{const u=o.native.ctrlKey;i.enabledToggled!==u&&(i.enabledToggled=u,t())},r)];e.addHandles(a,Ze)},Qe);e.addHandles(n)}function Or(e){return Bs(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length}function Cr(e){return e?.type==="line"}function gn(e){if(!e)return null;const t=e.wkid;if(t)return as[t];const n=e.wkt2??e.wkt;return n?ii(n):null}function ii(e){const t=os.exec(e);if(!t||t.length!==2)return null;const n=t[1].split(",");if(!n||n.length<3)return null;const s=parseFloat(n[1]),i=parseFloat(n[2]);return isNaN(s)||isNaN(i)?null:{a:s,f:i===0?0:1/i}}function Qt(e){const t=gn(e);if(ri(t))return t;const n=t.a*(1-t.f);return Object.assign(t,{b:n,eSq:1-(n/t.a)**2,radius:(2*t.a+n)/3,densificationRatio:1e4/((2*t.a+n)/3)})}function ri(e){return e!=null&&"b"in e&&"eSq"in e&&"radius"in e}function kt(e,t,n){const{a:s,eSq:i}=Qt(n),r=Math.sqrt(i),a=Math.sin(t[1]*N),o=s*t[0]*N;let u;return i>0?u=s*((1-i)*(a/(1-i*(a*a))-1/(2*r)*Math.log((1-r*a)/(1+r*a))))*.5:u=s*a,e[0]=o,e[1]=u,e}function mt(e){return rs(e)&&!!gn(e)}function Hr(e,t="square-meters"){if(e.some(a=>!mt(a.spatialReference)))throw new Tt("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const n=[];for(let a=0;a<e.length;a++){const o=e[a],u=o.spatialReference,{radius:c,densificationRatio:l}=Qt(u),h=c*l;n.push(oi(o,h))}const s=[],i=[0,0],r=[0,0];for(let a=0;a<n.length;a++){const{rings:o,spatialReference:u}=n[a];let c=0;for(let l=0;l<o.length;l++){const h=o[l];kt(i,h[0],u),kt(r,h[h.length-1],u);let g=r[0]*i[1]-i[0]*r[1];for(let f=0;f<h.length-1;f++)kt(i,h[f+1],u),kt(r,h[f],u),g+=r[0]*i[1]-i[0]*r[1];c+=g}c=tn(c,"square-meters",t),s.push(c/-2)}return s}function ai(e,t="meters"){if(!e)throw new Tt("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some(s=>!mt(s.spatialReference)))throw new Tt("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const n=[];for(let s=0;s<e.length;s++){const i=e[s],{spatialReference:r}=i,a=i.type==="polyline"?i.paths:i.rings;let o=0;for(let u=0;u<a.length;u++){const c=a[u];let l=0;for(let h=1;h<c.length;h++){const g=c[h-1][0],f=c[h][0],v=c[h-1][1],m=c[h][1];if(v!==m||g!==f){const $=new zt;qt($,[g,v],[f,m],r),l+=$.distance}}o+=l}o=tn(o,"meters",t),n.push(o)}return n}function oi(e,t){if(e.type!=="polyline"&&e.type!=="polygon")throw new Tt("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:n}=e;if(!mt(n))throw new Tt("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const s=e.type==="polyline"?e.paths:e.rings,i=[],r=[0,0],a=new zt;for(const u of s){const c=[];i.push(c),c.push([u[0][0],u[0][1]]);let l,h,g=u[0][0],f=u[0][1];for(let v=0;v<u.length-1;v++){if(l=u[v+1][0],h=u[v+1][1],g===l&&f===h)continue;const m=[g,f];qt(a,[g,f],[l,h],n);const{azimuth:$,distance:x}=a,P=x/t;if(P>1){for(let z=1;z<=P-1;z++)gt(r,m,$,z*t,n),c.push(r.slice());gt(r,m,$,(x+Math.floor(P-1)*t)/2,n),c.push(r.slice())}gt(r,m,$,x,n),c.push(r.slice()),g=r[0],f=r[1]}}const o=us(en,n);return e.type==="polyline"?new nn({paths:i,spatialReference:o}):new cs({rings:i,spatialReference:o})}let zt=class{constructor(t=0,n=void 0,s=void 0){this.distance=t,this.azimuth=n,this.reverseAzimuth=s}};function gt(e,t,n,s,i){const r=t[0],a=t[1],o=r*N,u=a*N,c=(n??0)*N,{a:l,b:h,f:g}=Qt(i),f=Math.sin(c),v=Math.cos(c),m=(1-g)*Math.tan(u),$=1/Math.sqrt(1+m*m),x=m*$,P=Math.atan2(m,v),z=$*f,D=z*z,E=1-D,b=E*(l*l-h*h)/(h*h),j=1+b/16384*(4096+b*(b*(320-175*b)-768)),H=b/1024*(256+b*(b*(74-47*b)-128));let k,G,q,I=s/(h*j),wt=2*Math.PI;for(;Math.abs(I-wt)>1e-12;)q=Math.cos(2*P+I),k=Math.sin(I),G=Math.cos(I),wt=I,I=s/(h*j)+H*k*(q+H/4*(G*(2*q*q-1)-H/6*q*(4*k*k-3)*(4*q*q-3)));const V=x*k-$*G*v,B=Math.atan2(x*G+$*k*v,(1-g)*Math.sqrt(D+V*V)),pt=g/16*E*(4+g*(4-3*E)),re=Math.atan2(k*f,$*G-x*k*v)-(1-pt)*g*z*(I+pt*k*(q+pt*G*(2*q*q-1)));return e[0]=(o+re)/N,e[1]=B/N,e}function qt(e,t,n,s){const i=t[0]*N,r=t[1]*N,a=n[0]*N,o=n[1]*N,{a:u,b:c,f:l,radius:h}=Qt(s),g=a-i,f=Math.atan((1-l)*Math.tan(r)),v=Math.atan((1-l)*Math.tan(o)),m=Math.sin(f),$=Math.cos(f),x=Math.sin(v),P=Math.cos(v);let z,D,E,b,j,H,k,G,q,I,wt=1e3,V=g;do{if(k=Math.sin(V),G=Math.cos(V),E=Math.sqrt(P*k*(P*k)+($*x-m*P*G)*($*x-m*P*G)),E===0)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;j=m*x+$*P*G,H=Math.atan2(E,j),q=$*P*k/E,D=1-q*q,b=j-2*m*x/D,isNaN(b)&&(b=0),I=l/16*D*(4+l*(4-3*D)),z=V,V=g+(1-I)*l*q*(H+I*E*(b+I*j*(2*b*b-1)))}while(Math.abs(V-z)>1e-12&&--wt>0);if(wt===0){const Wn=h,Gn=Math.acos(Math.sin(r)*Math.sin(o)+Math.cos(r)*Math.cos(o)*Math.cos(a-i))*Wn,De=a-i,Un=Math.sin(De)*Math.cos(o),Jn=Math.cos(r)*Math.sin(o)-Math.sin(r)*Math.cos(o)*Math.cos(De),Kn=Math.atan2(Un,Jn);return e.azimuth=Kn/N,e.distance=Gn,e.reverseAzimuth=void 0,e}const B=D*(u*u-c*c)/(c*c),pt=B/1024*(256+B*(B*(74-47*B)-128)),re=c*(1+B/16384*(4096+B*(B*(320-175*B)-768)))*(H-pt*E*(b+pt/4*(j*(2*b*b-1)-pt/6*b*(4*E*E-3)*(4*b*b-3)))),Zn=Math.atan2(P*Math.sin(V),$*x-m*P*Math.cos(V)),Fn=Math.atan2($*Math.sin(V),$*x*Math.cos(V)-m*P);return e.azimuth=Zn/N,e.distance=re,e.reverseAzimuth=Fn/N,e}function Vr(e){return mt(e)?e:Se(e)?en.WGS84:null}function Me({start:e,end:t,type:n},s,i){const r=[],a=lt(Nt,t,e),o=lt(te,e,s),u=Gt(a),c=2*Bt(a,o),l=c*c-4*u*(Gt(o)-i*i);if(l===0){const h=-c/(2*u);(n===0||h>=0)&&r.push(Ht(ft(),e,a,h))}else if(l>0){const h=Math.sqrt(l),g=(-c+h)/(2*u);(n===0||g>=0)&&r.push(Ht(ft(),e,a,g));const f=(-c-h)/(2*u);(n===0||f>=0)&&r.push(Ht(ft(),e,a,f))}return r}function yn(e,t){const n=e.start,s=e.end,i=lt(Nt,s,n),r=ht(ne,-i[1],i[0],0),a=t.start,o=t.end,u=O(Pe,o,a),c=A(u,r),l=ht(xn,n[0],n[1],0),h=O(Mn,l,a),g=A(h,r),f=Pt();if(Math.abs(c)<f)return[];const v=L(Tn,a,u,g/c);if(t.type===0){const m=O(we,v,a);if(A(m,u)<-f)return[]}if(e.type===1){const m=ds(te,v,n);if(Bt(m,i)<-f)return[]}return[ot(v)]}function ui(e,t){return li(Jt(Re,t[2],e),t)}function vn(e,t){return bn(Jt(Re,0,e),Jt(fi,0,t)).map(([s,i])=>It(s,i))}function mn(e,t,n){return _n(e,Jt(Re,e[2],t),n)}function $n(e,t,n,s=y()){const i=lt(Nt,e,t),r=hs(i);return Ht(s,t,i,r===0?1:n/r),s[2]=e[2],s}function _n(e,{start:t,end:n,type:s},i=y()){const r=O(ee,e,t),a=O(ne,n,t),o=A(r,a)/A(a,a);return L(i,t,a,s===0?Math.max(o,0):o)}const ci=(()=>{const e=y(),t=y(),n=y();return({start:s,end:i},{center:r,radius:a,normal:o,slicePlane:u})=>{const c=Yt(r,o,pi);if(_(_e(c,s),0)&&_(_e(c,i),0)){sn(o,e,t);const h=(v,m)=>(Xt(n,m,r),an(v,A(n,e),A(n,t)),v),g=Xs({start:h(Nt,s),end:h(te,i)},fs,a),f=[];for(const[v,m]of g){const $=xe(y(),r);L($,$,e,v),L($,$,t,m),u&&!ct(u,$)||f.push($)}return f}const l=y();return rn(c,s,i,l)?!_(Mt(l,r),a)||u&&!ct(u,l)?[]:[l]:[]}})();function wn({start:e,end:t,type:n},s,i){const r=[],a=Xt(ee,t,e),o=lt(te,e,s),u=Gt(a),c=2*Bt(a,o),l=c*c-4*u*(Gt(o)-i*i);if(l===0){const h=-c/(2*u);(n===1||h>=0)&&r.push(L(y(),e,a,h))}else if(l>0){const h=Math.sqrt(l),g=(-c+h)/(2*u);(n===1||g>=0)&&r.push(L(y(),e,a,g));const f=(-c-h)/(2*u);(n===1||f>=0)&&r.push(L(y(),e,a,f))}return r}function bn(e,t){const n=e.start,s=e.end,i=t.start,r=t.end,a=O(ee,s,n),o=O(ne,r,i),u=O(Pe,i,n),c=Wt(xn,a,o);if(!_(A(u,c),0))return[];const l=$e(c);if(_(l,0))return[];const h=Wt(Mn,u,o),g=A(h,c)/l,f=L(Tn,n,a,g);if(e.type===0){const v=O(we,f,n);if(A(a,v)<-Pt())return[]}if(t.type===0){const v=O(we,f,i);if(A(o,v)<-Pt())return[]}return[ot(f)]}function li({start:e,end:t,type:n},s){const i=O(ee,s,e),r=O(ne,t,e),a=Wt(Pe,r,i),o=$e(a)/$e(r),u=Pt();if(o<u)switch(n){case 1:return[ot(s)];case 0:return A(r,i)<-u?[]:[ot(s)]}return[]}function Te(e,t,n,s){const[i,r]=e,[a,o]=n,u=a-i,c=o-r,l=u*u+c*c,h=Math.sqrt(l);if(h>t+s)return[];if(h<Math.abs(t-s))return[];if(_(h,0)&&_(t,s))return[];const g=(t*t-s*s+l)/(2*h),f=Math.sqrt(t*t-g*g),v=f*c/h,m=f*u/h,[$,x]=ps(Nt,e,n,g/h);return _(v,m)?[It($,x)]:[It($+v,x-m),It($-v,x+m)]}function Jt(e,t,{start:n,end:s,type:i}){return ht(e.start,n[0],n[1],t),ht(e.end,s[0],s[1],t),e.type=di[i],e}function Sn(e,t){return _(e[2],t[2])}function _(e,t){return ls(Math.abs(e-t),0,Pt())}function hi(e,t){return t.filter(n=>ct(e,n))}function ct(e,t){return gs(e,t)}const di={0:1,1:0},Nt=ft(),te=ft(),ee=y(),ne=y(),Pe=y(),xn=y(),Mn=y(),Tn=y(),we=y(),pi=F(),Re={start:y(),end:y(),type:1},fi={start:y(),end:y(),type:1};class W{intersect(t){return nt(this,t)}closestPoints(t){return[this.closestTo(t)]}}class $t extends W{constructor(t){super(),this.point=t}equals(t){return this===t||U(t)&&S(this.point,t.point)}closestTo(){return vt(this.point)}}class Ee extends W{constructor(t,n,s){super(),this.start=t,this.end=n,this.lineLike={start:t,end:n,type:s}}equals(t){return this===t||X(t)&&this.lineLike.type===t.lineLike.type&&S(this.start,t.start)&&S(this.end,t.end)}closestTo(t){const n=C();return _n(t,this.lineLike,n),n}}class Le extends Ee{constructor(t,n){super(t,n,1)}}class gi extends Ee{constructor(t,n){super(t,n,0)}}class Pn extends W{constructor(t){super(),this.constraints=t}equals(t){return this===t||be(t)&&bs(this.constraints,t.constraints,(n,s)=>n.equals(s))}closestTo(t){let n,s=1/0;for(const i of this.constraints){const r=i.closestTo(t),a=me(t,r);a<s&&(s=a,n=r)}return vt(n??t)}closestPoints(t){return this.constraints.flatMap(n=>n===this?[]:n.closestPoints(t))}}class Rn extends W{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||Q(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const n=C();return $n(t,this.center,this.radius,n),n}}class ze extends W{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||it(t)&&S(this.center,t.center)&&this.radius===t.radius}closestTo(t){const n=C();return $n(t,this.center,this.radius,n),n[2]=this.center[2],n}asCircle(){return new qe(vt(this.center),this.radius,dt(0,0,1))}}class qe extends W{constructor(t,n,s,i=void 0){super(),this.center=t,this.radius=n,this.normal=s,this.slicePlane=i}equals(t){return this===t||ut(t)&&S(this.center,t.center)&&S(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:n,radius:s}=this;on(this.getPlane(yi),t,le);const i=O(le,le,n),r=Ss(i);if(_(r,0))return vt(t);const a=s/Math.sqrt(r),o=C();L(o,n,i,a);const{slicePlane:u}=this;return u&&!ct(u,o)?ke(u,this)?.closestTo(t)??vt(t):o}getPlane(t=F()){return Yt(this.center,this.normal,t)}}const le=y(),yi=F();class vi extends W{constructor(t){super(),this.z=t}equals(t){return this===t||st(t)&&this.z===t.z}closestTo(t){return dt(t[0],t[1],this.z)}getPlane(t=F()){return ht(Fe,0,0,this.z),Yt(Fe,$s,t)}}const Fe=y();class Ne extends W{constructor(t,n,s){super(),this.start=t,this.end=n,this.planeLike={start:t,end:n,type:s}}equals(t){return this===t||Y(t)&&this.planeLike.type===t.planeLike.type&&S(this.start,t.start)&&S(this.end,t.end)}closestTo(t){const n=C();return mn(t,this.planeLike,n),n}closestEndTo(t){const{start:n,end:s}=this.planeLike;return Math.sign(Bt(lt(mi,s,n),lt($i,t,n)))>0?this.end:this.start}getPlane(t=F()){const n=xe(We,this.end);return n[2]+=1,ys(this.start,this.end,n,t)}getSlicePlane(t=F()){const{start:n,end:s,type:i}=this.planeLike;if(i===0)return;const r=ht(We,n[0],n[1],0),a=ht(Ge,s[0],s[1],0),o=Xt(Ge,a,r);return Yt(r,o,t),t}}const mi=ft(),$i=ft(),We=y(),Ge=y();class Zr extends Ne{constructor(t,n){super(t,n,1)}}class En extends Ne{constructor(t,n){super(t,n,0)}}class _i extends W{constructor(t,n){super(),this.sphere=xs(t,n),this._center=ot(t)}equals(t){return this===t||rt(t)&&Ms(this.sphere,t.sphere)}closestTo(t){const n=C();return Ts(this.sphere,t,n),n}get center(){return this._center}get radius(){return this.sphere[3]}}class Ln extends W{constructor(t,n,s){super(),this.start=t,this.end=n,this.getZ=s,this.planeLike={start:t,end:n,type:0}}equals(t){return this===t||Kt(t)&&S(this.start,t.start)&&S(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return Ti(this,t)}addIfOnTheGround(t,n){for(const s of n){const i=this.getZ(s[0],s[1])??0;_(s[2],i)&&(s[2]=i,t.push(s))}}}class wi extends W{constructor(t,n,s){super(),this._x=t,this._y=n,this._z=s}equals(t){return this===t||Vi(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,n,s]){return pn(this._x??t,this._y??n,this._z??s)}}class bi extends W{constructor(t,n,s,i,r){super(),this._origin=t,this._spatialReference=n,this._distanceMeters=s,this._z=i,this._directionDegrees=r}equals(t){return this===t||Ii(t)&&Oe(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,n,s]){return an(bt,t,n),Oe(bt,this._origin)||this._applyDirectionAndDistance(bt),pn(bt[0],bt[1],this._z??s)}_applyDirectionAndDistance(t){if(this._directionDegrees!=null&&this._distanceMeters!=null)gt(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)xi(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:n}=qt(Si,this._origin,t,this._spatialReference);gt(t,this._origin,n??0,this._distanceMeters,this._spatialReference)}}}const bt=[0,0],Si=new zt;function xi(e,t,n,s,i){let{azimuth:r,distance:a}=qt(Mi,t,s,i);r??=0;let o=a*Math.cos((r-n)*N);o=Math.max(0,o),gt(e,t,n,o,i)}const Mi=new zt;function Ti(e,t){const n=C();return mn(t,e.planeLike,n),n[2]=e.getZ(n[0],n[1])??qn,n}function nt(e,t){if(be(e)){const n=[];for(const s of e.constraints){const i=s.intersect(t);i&&n.push(i)}return Ae(n)}if(be(t))return nt(t,e);if(Kt(e))return Ue(e,t);if(Kt(t))return Ue(t,e);if(U(e)){const{point:n}=e;if(U(t))return S(n,t.point)?e:void 0;const s=t.closestTo(n);return vs(s,n)?e:void 0}if(X(e)){if(U(t))return nt(t,e);if(X(t))return K(bn(e.lineLike,t.lineLike));if(st(t))return Pi(e,t);if(Y(t))return K(yn(t.planeLike,e.lineLike));if(Q(t))return K(wn(e.lineLike,t.center,t.radius));if(ut(t))return K(ci(e.lineLike,t));if(it(t))return Ri(e,t);if(rt(t))return Ei(e,t)}else if(st(e)){if(U(t)||X(t))return nt(t,e);if(st(t))return Li(e,t);if(Y(t))return zi(e,t);if(Q(t))return qi(e,t);if(ut(t))return ki(e,t);if(it(t))return Ni(e,t);if(rt(t))return Ai(e,t)}else if(Y(e)){if(U(t)||X(t)||st(t))return nt(t,e);if(Y(t))return he(vn(e.planeLike,t.planeLike));if(Q(t))return he(Me(e.planeLike,t.center,t.radius));if(ut(t))return ji(e,t);if(it(t))return Di(e,t);if(rt(t))return Oi(e,t)}else if(Q(e)){if(U(t)||X(t)||st(t)||Y(t))return nt(t,e);if(Q(t))return he(Te(e.center,e.radius,t.center,t.radius));if(ut(t))return void 0;if(it(t))return Ci(e,t);if(rt(t))return void 0}else if(ut(e)){if(U(t)||X(t)||st(t)||Y(t)||Q(t))return nt(t,e);if(ut(t))return void 0;if(it(t))return t.asCircle(),void 0;if(rt(t))return void 0}else if(it(e)){if(U(t)||X(t)||st(t)||Y(t)||Q(t)||ut(t))return nt(t,e);if(it(t))return Hi(t,e);if(rt(t))return void 0}else if(rt(e)){if(U(t)||X(t)||st(t)||Y(t)||Q(t)||it(t))return nt(t,e);if(rt(t))return void 0}}const Pi=(()=>{const e=F();return(t,n)=>{const{start:s,end:i}=t;if(Sn(s,i)&&_(s[2],n.z))return t;const r=C();return rn(n.getPlane(e),s,i,r)?new $t(r):void 0}})();function Ri({lineLike:e},{center:t,radius:n}){const s=t[2];return K(wn(e,t,n).filter(i=>_(i[2],s)))}function Ei({lineLike:e},{sphere:t}){return K(_s(t,e.start,e.end))}const ke=(()=>{const e=Ls(),t=y(),n=y();return(s,i,r)=>{const{normal:a,center:o,radius:u}=i;sn(a,t,n);const c=un(s),l=u*A(c,t),h=u*A(c,n);Ps(e,o[0],o[1],o[2],1);const g=Rs(s,e),f=Math.hypot(l,h),v=_(f,0);if(_(_e(s,o),0)){if(v)return i;if(_(u,0))return!r||ct(r,o)?new $t(vt(o)):void 0;Wt(t,c,a),Es(t,t);const b=new Array,j=ot(o);L(j,j,t,u),r&&!ct(r,j)||b.push(j);const H=ot(o);return L(H,H,t,-u),r&&!ct(r,H)||b.push(H),K(b)}if(v)return;const m=-g/f;if(Math.abs(m)>1||_(m,1))return;const $=Math.atan(l/h),x=zs(m)-$,P=Math.PI-x,z=new Array,D=y();L(D,o,t,u*Math.cos(x)),L(D,D,n,u*Math.sin(x)),z.push(D);const E=y();return L(E,o,t,u*Math.cos(P)),L(E,E,n,u*Math.sin(P)),z.push(E),K(r?hi(r,z):z)}})();function Li(e,t){return _(e.z,t.z)?e:void 0}function zi({z:e},{planeLike:t}){const[n,s]=t.start,[i,r]=t.end,a=dt(n,s,e),o=dt(i,r,e);return t.type===0?new Le(a,o):new gi(a,o)}function qi(e,t){const[n,s]=t.center;return new ze(dt(n,s,e.z),t.radius)}function Ni(e,t){return _(t.center[2],e.z)?t:void 0}const ki=(()=>{const e=F();return(t,n)=>ke(t.getPlane(e),n,n.slicePlane)})();function Ai(e,{center:t,radius:n}){const s=Math.abs(t[2]-e.z);if(s>n&&!_(s,n))return;const i=dt(t[0],t[1],e.z),r=Math.sqrt(n**2-s**2);return _(r,0)?void 0:new ze(i,r)}const Di=(()=>{const e=F();return(t,{center:n,radius:s})=>{const i=Me(t.planeLike,n,s),r=n[2];t.getSlicePlane(e);const a=new Array;for(const[o,u]of i){const c=[o,u,r];ct(e,c)&&a.push(c)}return K(a)}})(),ji=(()=>{const e=F(),t=F();return(n,s)=>ke(n.getPlane(e),s,n.getSlicePlane(t))})(),Oi=(()=>{const e=F();return(t,{center:n,radius:s})=>{const i=t.getPlane(e),r=ws(i,n),a=Math.abs(r);if(a>s&&!_(a,s))return;const o=Math.sqrt(s**2-r**2);if(_(o,0)){const l=C();return on(i,n,l),new $t(l)}const u=C(),c=ot(un(i));return L(u,n,c,r),new qe(u,o,c,t.getSlicePlane())}})();function Ci(e,t){const n=cn(e.center,t.center);return _(n,0)&&_(e.radius,t.radius)?t:zn(Te(e.center,e.radius,t.center,t.radius),t.center[2])}function Hi(e,t){if(!Sn(e.center,t.center))return;const n=cn(e.center,t.center);return _(n,0)&&_(e.radius,t.radius)?e:zn(Te(e.center,e.radius,t.center,t.radius),e.center[2])}function Ue(e,t){const{planeLike:n,getZ:s}=e,i=new Array;if(U(t))e.addIfOnTheGround(i,ui(n,t.point));else if(X(t))e.addIfOnTheGround(i,yn(n,t.lineLike));else if(Q(t))for(const[r,a]of Me(n,t.center,t.radius)){const o=s(r,a);o!=null&&i.push(Ft(r,a,o))}else if(Y(t)||Kt(t))for(const[r,a]of vn(n,t.planeLike)){const o=s(r,a)??qn;i.push(Ft(r,a,o))}return K(i)}function he(e){return Ae(e.map(([t,n])=>{const s=dt(t,n,0),i=dt(t,n,1);return new Le(s,i)}))}function K(e){return Ae(e.map(t=>t?new $t(t):void 0))}function zn(e,t){return K(e.map(([n,s])=>[n,s,t]))}function Ae(e){if(e.length!==0)return e.length===1?e[0]??void 0:new Pn(e.filter(ms))}function be(e){return e instanceof Pn}function U(e){return e instanceof $t}function X(e){return e instanceof Ee}function st(e){return e instanceof vi}function Y(e){return e instanceof Ne}function Q(e){return e instanceof Rn}function it(e){return e instanceof ze}function ut(e){return e instanceof qe}function rt(e){return e instanceof _i}function Kt(e){return e instanceof Ln}function Ii(e){return e instanceof bi}function Vi(e){return e instanceof wi}const qn=0;let _t=class{constructor(t,n,s,i){this.targetPoint=t,this.constraint=n,this.isDraped=s,this.domain=i}},Nn=class extends _t{constructor({targetPoint:t,objectId:n,constraint:s,isDraped:i}){super(t,s,i,1),this.objectId=n}},se=class{constructor(t,n){this.isDraped=t,this.domain=n}},tt=class kn extends se{constructor(t,n,s,i,r=3,a=!0,o=!0){super(i,r),this.type=t,this.lineStart=n,this.lineEnd=s,this.fadeLeft=a,this.fadeRight=o}equals(t){return t instanceof kn&&this.type===t.type&&S(this.lineStart,t.lineStart)&&S(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return Mt(this.lineStart,this.lineEnd)}};class Zi extends Nn{constructor(t){super({...t,isDraped:!0,constraint:new Ln(t.edgeStart,t.edgeEnd,t.getGroundElevation)})}get hints(){return[new tt(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}let Fi=class extends Nn{constructor(t){super({...t,constraint:new Le(t.edgeStart,t.edgeEnd)})}get hints(){return[new tt(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Wi=class An extends se{constructor(t,n,s=3){super(n,s),this.intersectionPoint=t}equals(t){return t instanceof An&&S(this.intersectionPoint,t.intersectionPoint)}},Vt=class extends _t{constructor(t,n,s,i){super(t,new $t(t),i,3),this.first=n,this.second=s}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Wi(this.targetPoint,this.isDraped,this.domain)]}},Gi=class extends _t{constructor({lineStart:t,lineEnd:n,targetPoint:s,isDraped:i}){super(s,new En(t,n),i,2),this._referenceLineHint=new tt(2,t,n,i,this.domain)}get hints(){return[this._referenceLineHint,new tt(0,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},Ui=class Dn extends se{constructor(t,n,s,i=3){super(s,i),this.lineStart=t,this.lineEnd=n}equals(t){return t instanceof Dn&&S(this.lineStart,t.lineStart)&&S(this.lineEnd,t.lineEnd)}},Ji=class extends _t{constructor({referenceLine:t,lineStart:n,targetPoint:s,isDraped:i}){const r=ot(n),{left:a,right:o}=t;Xt(r,qs(r,r,o),a),super(s,new En(n,r),i,2),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new tt(0,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new Ui(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(t=>new tt(1,t.edge.left,t.edge.right,this.isDraped,this.domain,t.fadeLeft,t.fadeRight))]}addReferenceLine(t){const n={edge:t,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(s=>{S(t.right,s.edge.left)&&(s.fadeLeft=!1,n.fadeRight=!1),S(t.right,s.edge.right)&&(s.fadeRight=!1,n.fadeRight=!1),S(t.left,s.edge.right)&&(s.fadeRight=!1,n.fadeLeft=!1),S(t.left,s.edge.left)&&(s.fadeLeft=!1,n.fadeLeft=!1)}),this._referenceLines.push(n)}},jn=class On extends se{constructor(t,n,s,i,r=3){super(i,r),this.previousVertex=t,this.centerVertex=n,this.nextVertex=s}equals(t){return t instanceof On&&S(this.previousVertex,t.previousVertex)&&S(this.centerVertex,t.centerVertex)&&S(this.nextVertex,t.nextVertex)}},Ki=class extends _t{constructor({targetPoint:t,constraint:n,previousVertex:s,otherVertex:i,otherVertexType:r,isDraped:a,selfSnappingType:o,objectId:u,domain:c}){super(t,n,a,c??2),this.previousVertex=s,this.otherVertex=i,this.otherVertexType=r,this.selfSnappingType=o??0,this.objectId=u??null}get hints(){const t=this.previousVertex,n=this.otherVertexType===1?this.otherVertex:this.targetPoint,s=this.otherVertexType===1?this.targetPoint:this.otherVertex;return[new tt(0,n,s,this.isDraped,this.domain),new tt(1,t,n,this.isDraped,this.domain),new jn(this.previousVertex,n,s,this.isDraped,this.domain)]}},Bi=class extends _t{constructor({targetPoint:t,point1:n,point2:s,isDraped:i}){super(t,new Rn(Ns(y(),n,s,.5),.5*ks(n,s)),i,2),this._p1=n,this._p2=s}get hints(){return[new tt(1,this.targetPoint,this._p1,this.isDraped,this.domain),new tt(1,this.targetPoint,this._p2,this.isDraped,this.domain),new jn(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function Qr(e,t,n,s){const i=n.projectToRenderScreen(e,Qi),r=n.projectToRenderScreen(t,tr);return i==null||r==null?null:(lt(s,r,i),As(s,s),s)}function Xi(e,t,n,s,i=y()){const r=xe(Yi,e);return r[2]=Xe(s,r,t,n)||0,s.renderCoordsHelper.toRenderCoords(r,t,i),i}const Yi=y(),Qi=ln(),tr=ln();function er(e,t,n,s){return s.type==="2d"?(At.x=e[0],At.y=e[1],At.spatialReference=t,s.toScreen(At)):(Xi(e,t,n,s,Je),s.state.camera.projectToScreen(Je,de),Ds(de[0],de[1]))}const At=Et(0,0,0,null),Je=y(),de=js();function ta(e){return mt(e)||Se(e)}function Cn(e,t,n,...s){return mt(e)?t.apply(void 0,s):e.isWebMercator?n.apply(void 0,s):null}const ea=1e5;function nr(e){const{spatialReference:t}=e;return Cn(t,ur,cr,e)}function sr(e,t){if(!Lt(e.spatialReference,t.spatialReference))return null;const{spatialReference:n}=e;return Dt[0]=e.x,Dt[1]=e.y,Dt[2]=e.hasZ?e.z:0,jt[0]=t.x,jt[1]=t.y,jt[2]=t.hasZ?t.z:0,Hn(Dt,jt,n)}function Hn(e,t,n){return Cn(n,ar,or,e,t,n)}const ir={geodesicLength:nr,geodesicDistanceBetweenPoints:sr,geodesicDistance:Hn};async function rr(){return await Ys(),ir}function ar(e,t,n){return Z(qt(hr,e,t,n).distance,"meters")}function or(e,t,n){return Z(dn(lr(e,t,n),{unit:"meters"}),"meters")}function ur(e){return Z(ai([e],"meters")[0],"meters")}function cr(e){return Z(dn(e,{unit:"meters"}),"meters")}function lr(e,t,n){return new nn({spatialReference:n,paths:[[[...e],[...t]]]})}const hr=new zt,Dt=y(),jt=y();let et=class extends Os{constructor(e){super(e),this.options=new R,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}initialize(){this.addHandles([ve(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:n,effectiveFeatureEnabled:s,effectiveGridEnabled:i}=this.options;return{selfEnabled:n,featureEnabled:s,gridEnabled:this.view.type==="2d"&&i,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=Cs(n=>this._updateEngines(e,t,n))},Qe),ve(()=>this.options,e=>{for(const t of this._engines)t.options=e},Hs)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,n){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const s=this._engineCache,i=await Promise.allSettled([e.featureEnabled&&!s.has("feature")?this._createFeatureSnappingEngine(n):void 0,e.selfEnabled&&!s.has("self")?this._createSelfSnappingEngine(n):void 0,e.gridEnabled&&!s.has("grid")?this._createGridSnappingEngine(n):void 0]);if(n.aborted)for(const r of i)r.status==="fulfilled"&&r.value?.engine.destroy();else{for(const r of i)r.status==="fulfilled"&&r.value&&s.set(r.value.type,r.value.engine);this._engines=Array.from(s.values())}}async _createSelfSnappingEngine(e){const[{SelfSnappingEngine:t},n]=await Promise.all([ae(()=>import("./SelfSnappingEngine-CNEP73tc.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),rr()]);return oe(e),{type:"self",engine:new t({view:this.view,options:this.options,geodesicLengthMeasurementUtils:n})}}async _createGridSnappingEngine(e){const{view:t}=this;if(t.type!=="2d")return;const{GridSnappingEngine:n}=await ae(()=>import("./GridSnappingEngine-Bc_5-3OS.js"),__vite__mapDeps([8,1,2,5,4,6,7]));return oe(e),{type:"grid",engine:new n({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await ae(()=>import("./FeatureSnappingEngine-BVfkHAmT.js"),__vite__mapDeps([9,1,2,5,4,6,7]));oe(e);const{view:n,options:s}=this,{spatialReference:i}=n;return{type:"feature",engine:new t({view:n,options:s,spatialReference:i})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}snap(e){return fr(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:n}=e;this._removeVisualization();const s=this._currentMainCandidate;if(s==null)return t;const i=this._selectUpdateInput(e);if(i==null)return t;const{spatialReference:r}=n,a=Ce(i,r);if(a==null)return t;const{view:o}=this,{elevationInfo:u,visualizer:c}=n,l=[],h=St(a,o,u),g=s.constraint.closestTo(h);if(!this._arePointsWithinScreenThreshold(h,g,n)||!fe(s,n.drawConstraints))return this._resetSnappingState(),t;s.targetPoint=ce(g),l.push(...s.hints);for(const f of this._currentOtherActiveCandidates)fe(f,n.drawConstraints)&&(f.targetPoint=ce(g),l.push(...f.hints));return c!=null&&this.addHandles(c.draw(l,{spatialReference:r,elevationInfo:gr(n),view:o,selfSnappingZ:n.selfSnappingZ}),pe),Ve(g,o,t,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case 0:return e;case 1:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}_removeVisualization(){this.removeHandles(pe)}async _snapSinglePoint({point:e,context:t,signal:n}){const{view:s}=this,{elevationInfo:i}=t,r=St(e,s,i),a=await this._fetchCandidates(r,3,t,n);return this._createSnapResult(r,0,a,s,e,t,n)}async _snapMultiPoint({point:e,scenePoint:t,context:n,signal:s}){const{view:i}=this,{coordinateHelper:r,elevationInfo:a,spatialReference:o}=n;await Is(t.spatialReference,o);const u=Ce(t,o),c=St(u,i,a),l=await this._fetchCandidates(c,1,n,s);if(l.length>0){const f=await this._fetchCandidates(c,2,n,s);return this._createSnapResult(c,1,[...l,...f],i,u,n,s)}const h=St(e,i,a),g=await this._fetchCandidates(h,2,n,s);return this._createSnapResult(h,0,g,i,{z:r.hasZ()&&e.hasZ?e.z??0:void 0,m:r.hasM()&&e.hasM?e.m??0:void 0},n,s)}async _fetchCandidates(e,t,n,s){return(await Promise.all(this._engines.map(i=>i.fetchCandidates(e,t,n,s)))).flat()}_createSnapResult(e,t,n,s,i,r,a){return{get valid(){return!Vs(a)},apply:()=>{const{spatialReference:o}=r,{snappedPoint:u,hints:c}=this._processCandidates(e,t,n,r);return this._removeVisualization(),r.visualizer!=null&&this.addHandles(r.visualizer.draw(c,{spatialReference:o,elevationInfo:yt,view:s,selfSnappingZ:r.selfSnappingZ}),pe),Ve(u,s,i,r)}}}_processCandidates(e,t,n,s){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),ni(e,n);const i=this._currentMainCandidate;if(i!=null){const r=pr(i,n);if(r>=0){if(!(n[r]instanceof Vt))return this._intersectWithOtherCandidates(r,n,e,t,s);if(this._arePointsWithinScreenThreshold(e,i.targetPoint,s))return this._updateSnappingCandidate(i,t,n,s)}}return this._intersectWithOtherCandidates(0,n,e,t,s)}_intersectWithOtherCandidates(e,t,n,s,i){const{coordinateHelper:r}=i,a=t[e],o=[];for(let u=0;u<t.length;++u){if(u===e)continue;const c=t[u],l=a.constraint.intersect(c.constraint);if(l)for(const h of l.closestPoints(a.targetPoint))o.push([new Vt(ce(h),a,c,c.isDraped),this._squaredScreenDistance(n,h,r)])}return o.length>0&&(o.sort((u,c)=>u[1]-c[1]),o[0][1]<this._squaredPointProximityThreshold(i.pointer))?this._updateSnappingCandidate(o[0][0],s,t,i):fe(a,i.drawConstraints)?this._updateSnappingCandidate(a,s,t,i):{snappedPoint:n,hints:[]}}_updateSnappingCandidate(e,t,n,s){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const i=this._currentMainCandidate.targetPoint,r=[];r.push(...e.hints);for(const a of n){if(e instanceof Vt){if(a.constraint.equals(e.first.constraint)||a.constraint.equals(e.second.constraint))continue}else if(a.constraint.equals(e.constraint))continue;const o=a.constraint.closestTo(i);this._squaredScreenDistance(o,i,s.coordinateHelper)<dr()&&(a.targetPoint=i,this._currentOtherActiveCandidates.push(a),r.push(...a.hints))}return{snappedPoint:i,hints:r}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return fn(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return er(e,t.spatialReference,yt,this.view)}get test(){}};d([p({constructOnly:!0})],et.prototype,"view",void 0),d([p()],et.prototype,"options",void 0),d([p({readOnly:!0})],et.prototype,"updating",null),d([p()],et.prototype,"_loadTask",void 0),d([p()],et.prototype,"_engines",void 0),d([p()],et.prototype,"_squaredMouseProximityThreshold",null),d([p()],et.prototype,"_squaredTouchProximityThreshold",null),et=d([Rt("esri.views.interactive.snapping.SnappingManager")],et);const pe="visualization-handle";function dr(){return Ut.satisfiesConstraintScreenThreshold*Ut.satisfiesConstraintScreenThreshold}function fe(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof Zi||e instanceof Fi||e instanceof Gi||e instanceof Ji||e instanceof Bi)&&(!(e instanceof Ki)||t.direction==null&&e.selfSnappingType===1)}function pr(e,t){return e instanceof Vt?ge(t,e.first)>=0&&ge(t,e.second)>=0?0:-1:ge(t,e)}function ge(e,t){let n=-1;for(let s=0;s<e.length;++s)if(t.constraint.equals(e[s].constraint)){n=s;break}return n}function fr(e){return e.scenePoint!=null}function gr({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?yt:t}function In(e){return Fs(e)?Ws(e)||Se(e)||Gs(e)||Us(e)?Zs:e:Js(e)}function na(e){return yr(e)}function yr(e,t){const{hasZ:n,spatialReference:s}=e,i=In(s);let r=0;const a=hn(i);if(a==null)return null;const o=Vn;for(const u of e.paths){if(u.length<2)continue;const c=u.length-1;for(let l=0;l<c;++l){const h=u[l];M[0]=h[0],M[1]=h[1],M[2]=n?h[2]:0;const g=u[l+1];T[0]=g[0],T[1]=g[1],T[2]=n?g[2]:0;const f=o(M,T,s);if(f==null)return null;r+=f.value}}return Z(r,a)}function sa(e,t){const{spatialReference:n}=e;return Lt(n,t.spatialReference)?(M[0]=e.x,M[1]=e.y,M[2]=e.hasZ?e.z:0,T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,mr(M,T,n)):null}function ia(e,t){const{spatialReference:n}=e;return Lt(n,t.spatialReference)?(M[0]=e.x,M[1]=e.y,M[2]=e.hasZ?e.z:0,T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,$r(M,T,n)):null}function ra(e,t){const{spatialReference:n}=e;return Lt(n,t.spatialReference)?(M[0]=e.x,M[1]=e.y,M[2]=e.hasZ?e.z:0,T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,Vn(M,T,n)):null}function aa(e,t){const{spatialReference:n}=e;return Lt(n,t.spatialReference)?(M[0]=e.x,M[1]=e.y,M[2]=e.hasZ?e.z:0,T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,_r(M,T,n)):null}function oa(e){return e!=null?vr(e.hasZ?e.z:0,e.spatialReference):null}function vr(e,t){const n=Ks(t);return n!=null?Z(e??0,n):null}function mr(e,t,n){const s=ie(e,t,n);return s!=null?{direct:Z(s.direct,s.unit),horizontal:Z(s.horizontal,s.unit),vertical:Z(s.vertical,s.unit)}:null}function $r(e,t,n){const s=ie(e,t,n,0);return s!=null?Z(s.direct,s.unit):null}function Vn(e,t,n){const s=ie(e,t,n,1);return s!=null?Z(s.horizontal,s.unit):null}function _r(e,t,n){const s=ie(e,t,n,2);return s!=null?Z(s.verticalSigned,s.unit):null}function ie(e,t,n,s){const i=In(n),r=hn(i);if(r==null)return null;const a=t[2]-e[2];if(s===2)return{verticalSigned:a,unit:r};if(!ue(e,n,ye,i)||!ue(t,n,Ot,i))return null;if(s===0)return{direct:Mt(Ot,ye),unit:r};if(ht(Ct,e[0],e[1],t[2]),!ue(Ct,n,Ct,i))return null;const o=Mt(Ct,Ot);return s===1?{horizontal:o,unit:r}:{direct:Mt(Ot,ye),horizontal:o,vertical:Math.abs(a),unit:r}}const M=y(),T=y(),ye=y(),Ot=y(),Ct=y();export{_n as $,jn as A,Or as B,Ie as C,Ki as D,Zr as E,er as F,kr as G,Qr as H,zr as I,Lr as J,qr as K,Xi as L,mt as M,Vr as N,pn as O,Nr as P,Gi as Q,ai as R,Vt as S,C as T,Rr as U,oa as V,ta as W,fn as X,Cr as Y,Vn as Z,Dr as _,na as a,Ji as a0,Bi as a1,jr as a2,ia as a3,ea as a4,$r as a5,St as a6,Ve as a7,wi as a8,Rn as a9,Ae as aa,vi as ab,bi as ac,vr as ad,U as ae,aa as af,_r as ag,sa as ah,qt as b,zt as c,Er as d,ce as e,Zi as f,rr as g,Fi as h,at as i,gt as j,dt as k,Nn as l,ra as m,$t as n,Ar as o,Ut as p,et as q,In as r,se as s,Cn as t,R as u,Hr as v,Wi as w,tt as x,ni as y,Ui as z};

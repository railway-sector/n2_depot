const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lengthOperator-ivQu0sNN.js","assets/index-B9VIL3e7.js","assets/index-ClKQjglF.css","assets/Point2D-D6cTW4Xl.js","assets/Envelope2D-DdeZvC4f.js","assets/ProjectionTransformation-SnYCA3Wg.js","assets/Transformation2D-CiTBrf8G.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/OperatorDefinitions-DP7_WWTp.js","assets/jsonConverter-3sScDEQk.js","assets/apiConverter-k_pJ1MRL.js"])))=>i.map(i=>d[i]);
import{fb as le,s as nt,_ as at,c as M,cW as Q,hv as be,V as Ie,hw as de,xm as ot,aC as ye,kg as rt,sh as lt,ak as Oe,sl as ut,mJ as ct,cw as Ge,j3 as W,zZ as pt,dQ as ht,pI as dt,k2 as mt,ce as yt,z_ as vt,x3 as ft,aA as gt,Z as _t,f9 as wt,iN as Pe,aB as bt,e as r,m as u,h as D,a9 as H,an as P,ao as ue,aU as $e,el as Pt,z$ as Te,aJ as $t,ez as St,A0 as Et,pB as Dt,b0 as xt,em as Rt,f2 as kt,A1 as Ct,kr as O,f5 as oe,i$ as ze,ar as R,a2 as Vt,A2 as It,T as Ot,eu as Me,aF as Gt,jQ as Tt,ac as ve,jI as zt,ae as Le,dc as Ae,ap as ne,bP as Mt,U as ee,A3 as Lt,b1 as At,A4 as qe,cD as Ue,f as qt,cE as Ut,wq as Zt,wr as Ht,aS as fe,A5 as Ft,i as Nt,ex as pe,bK as jt,nN as Se,ab as Wt,w3 as Qt,A6 as Bt,io as Jt,gD as Kt}from"./index-B9VIL3e7.js";import{e as Xt}from"./AnalysisView3D-CBLHLgzc.js";import{R as Yt,M as ei,b as ti,j as Ze}from"./euclideanLengthMeasurementUtils-DZIP6sxa.js";import{b as ii}from"./settings-fdhT9FuI.js";import{R as He}from"./OutlineVisualElement-Btqs3b4d.js";import{l as Fe}from"./throttle-CPt9ZDCr.js";import{j as si}from"./createUtils-BHLAA0cX.js";import{e as ni}from"./getDefaultUnitForView-By9K6_tf.js";import{n as ai}from"./GraphicsLayer-7cI_QNsa.js";import{s as oi,d as ri}from"./SketchViewModel-69Gf1MMb.js";import"./utils-BJyoDuBg.js";import"./geometry2dUtils-Do_IgdQW.js";import"./geodeticLengthOperator-CbjYMCl8.js";import"./geodeticCurveType-CirnHLSB.js";import"./lineStippleUtils-CCavR4OV.js";import"./EngineVisualElement-DdugI3yj.js";import"./VisualElement-CpqRSPki.js";import"./LaserlinePath.glsl-ByjIuJzA.js";import"./line-BhTYkV4Y.js";import"./line-Ca0r75rv.js";import"./triangulationUtils-CNoiA1_V.js";import"./earcut-D9gy186-.js";import"./deduplicate-DaoSvPX3.js";import"./distanceOperator-C6WG3KzW.js";import"./Point2D-D6cTW4Xl.js";import"./Distance2DCalculator-CXhBP-8I-Vm5sXqq1.js";import"./ProjectionTransformation-SnYCA3Wg.js";import"./Envelope2D-DdeZvC4f.js";import"./Transformation2D-CiTBrf8G.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./apiConverter-k_pJ1MRL.js";import"./jsonConverter-3sScDEQk.js";import"./simplifyOperator-Bmkm7N_b.js";import"./operatorSimplify-Ysx29pH6.js";import"./mat2df64-DFLy2zOC.js";import"./SketchOptions-CGiGFdgT.js";import"./automaticAreaMeasurementUtils-wlFE62-v.js";import"./geodesicAreaMeasurementUtils-R0Db6M8D.js";import"./automaticLengthMeasurementUtils-CKTmYSmL.js";function E(t,e){let i,s=!1;function n(...o){const a=t.apply(this,o);return s&&i!==void 0&&e?.(i,a)?i:(s=!0,i=a,a)}return n}function Ne(t){return t?.map?.allLayers?.toArray().filter(e=>(e.type!=="graphics"||!e.internal)&&e.visible).map(e=>e.uid)??[]}let je={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:je.noDataValue,demResolution:"auto",maximumAutoTileRequests:150,ignoreInvisibleLayers:!0,signal:null}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:le(10,"centimeters","meters"),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,profileLinesUpdateThrottleMillis:100,hoveredPointsStyle:{size:14,borderStyle:"solid",borderWidth:3,borderColor:"#ffffff",boxShadow:"0px 0px 0px 5px rgba(255,255,255,0.2)"}};function Z(){return je}const li={progress:1,hasZ:!1,samples:[],statistics:null,spatialReference:null};let ie=class extends nt{constructor(e,i,s){super(e,i,s),this.name="unknown",this.name=e}},re=class extends ie{constructor(){super("too-complex","The input geometry has too many points.")}},We=class extends ie{constructor(){super("invalid-geometry","The input geometry is invalid.")}};class ui extends ie{constructor(){super("elevation-query-error","Error querying elevation from provider.")}}let ci=class extends ie{constructor(){super("unknown","Unknown error.")}};async function pi(t,e,i,s,n,o,a){let l,c,p;const h=t.spatialReference,d=h.isGeographic||h.isWebMercator;let m=0;if(!d){const{execute:f}=await at(()=>import("./lengthOperator-ivQu0sNN.js").then(_=>_.l),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]));M(a),m=f(t,{unit:"meters"}),M(a)}const y=1/Q(s);if(d){await be([{source:h,dest:s},{source:h,dest:Ie.WGS84}],a);const f=Ei(t);l=Yt([f],"meters")[0];const _=Ee(l,n);if(Re(t,l,_)>o)throw new re;const v=De(f,e,i);({densifiedPath:c,distances:p}=gi(v,_,y)),c=de(c,s)}else{await be([{source:h,dest:s}],a),l=m;const f=Ee(l,n);if(Re(t,l,f)>o)throw new re;const _=De(t,e,i);({densifiedPath:c,distances:p}=fi(_,f,y)),M(a),c=de(c,s)}return{densifiedPath:c,pathLength:l*y,distances:p}}function Ee(t,e){const i=t/e.densificationMaxSamples;return Math.max(e.samplingDistance,i)}function De(t,e,i){if(e==null)return xe(t);const s=t.spatialReference,n=e.mode,o=ot(e,s);let a=null;switch(i.type){case"2d":a=hi(t,n,o);break;case"3d":a=di(t,n,o,i)}return a==null?xe(t):new ye({hasZ:!0,hasM:!1,spatialReference:s,paths:Qe(t.paths,a)})}function hi({hasZ:t},e,i){return e==="absolute-height"?t?([s,n,o])=>[s,n,o+i]:([s,n])=>[s,n,i]:null}function di({spatialReference:t,hasZ:e},i,s,{elevationProvider:n}){const o=(a,l,c,p)=>n?.getElevation(a,l,c,t,p)??0;switch(i){case"on-the-ground":return([a,l])=>[a,l,o(a,l,0,"ground")];case"absolute-height":return e?([a,l,c])=>[a,l,c+s]:([a,l])=>[a,l,s];case"relative-to-ground":return e?([a,l,c])=>[a,l,c+o(a,l,c,"ground")+s]:([a,l])=>[a,l,o(a,l,0,"ground")+s];case"relative-to-scene":return e?([a,l,c])=>[a,l,c+o(a,l,c,"scene")+s]:([a,l])=>[a,l,o(a,l,0,"scene")+s];default:return null}}function xe(t){return t.hasZ?new ye({hasZ:!1,hasM:!1,spatialReference:t.spatialReference,paths:Qe(t.paths,([e,i])=>[e,i])}):t}function Qe(t,e){const i=t.length,s=new Array(i);for(let n=0;n<i;++n){const o=t[n],a=o.length,l=new Array(o.length);s[n]=l;for(let c=0;c<a;++c)l[c]=e(o[c])}return s}function Be(t){return ge(t)&&t.paths.some(e=>e.length>1)}function mi(t){return yi(t)&&Be(t.geometry)}function yi(t){return Je(t)&&ge(t?.geometry)}function ge(t){return!Je(t)&&t!=null&&t.type==="polyline"}function Je(t){return t!=null&&"geometry"in t}function vi(t){const e=t?.layer;return e!=null&&e.type==="graphics"&&e.internal}function Ke(t,e,i,s,n){const{spatialReference:o,hasZ:a}=t,l={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:o,metersPerSR:Q(o)},c=[],p=[];let h=0;for(let d=0;d<t.paths.length;++d){const m=t.paths[d],y=new Array,f=new Array;let _=0;for(let v=1;v<m.length;++v){const w=m[v-1],x=m[v],S=s(l,w,x);let k;for(k=_;k<S.distance&&!rt(k,S.distance);k+=e)y.push(n(S,k)),f.push((h+k)*i);_=k-S.distance,h+=S.distance,y.push(x),f.push(h*i)}c[d]=y,p[d]=f}return{densifiedPath:new ye({spatialReference:o,hasZ:a,paths:c}),distances:p}}function fi(t,e,i){const{hasZ:s}=t;return Ke(t,e,i,wi,s?Si:$i)}function gi(t,e,i){const{hasZ:s}=t;return Ke(t,e,i,_i,s?Pi:bi)}function _i(t,e,i){return t.distance=0,ti(t,e,i,t.spatialReference),t.from=e,t.to=i,t}function wi(t,e,i){return t.from=e,t.to=i,t.distance=lt(i,e)*t.metersPerSR,t}function bi({from:t,azimuth:e,spatialReference:i},s){return Ze([0,0],t,e,s,i)}function Pi({from:t,to:e,azimuth:i,distance:s,spatialReference:n},o){const a=o/s,l=[0,0,Oe(t[2],e[2],a)];return Ze(l,t,i,o,n),l}function $i({from:t,to:e,distance:i},s){return ut([0,0],t,e,s/i)}function Si({from:t,to:e,distance:i},s){return ct([0,0,0],t,e,s/i)}function Ei(t){return ei(t.spatialReference)?t:de(t,Ie.WGS84)}function Xe(t){return t.paths.reduce((e,i)=>e+i.length,0)}function Re(t,e,i){return Xe(t)+Math.floor(e/i)+Math.max(0,t.paths.reduce(s=>1+s,0)-1)}function Di(t,e){const i=t.length;if(i===0)return null;const s=t[0],n=s.sampledZ;let o=n,a=n,l=0,c=0,p=null,h=null,d=n??0,m=0,y=0,f=n!=null?1:0,_=0,v=0;const w=Q(e),x=W(e),S=Z().minSlopeSampleDistance/w,k=2*S,L=new ke,G=new ke,ce=()=>{st(),L.copy(G),G.reset()},we=(C,X)=>{ce(),C>0&&C-L.start<=k&&(C=L.start+S),G.restart(C,X)},st=()=>{if(L.isHole||G.isHole)return;const C=G.avgElevation-L.avgElevation,X=G.start-L.start,Y=C*x,A=X*w,q=le(Math.atan2(Y,A),"radians","degrees");q>0?(m+=q,p=U(p,q),_++):q<0&&(y-=q,h=U(h,-q),v++)};s.sampledZ!=null&&we(s.distance,s.sampledZ);for(let C=1;C<i;++C){const X=t[C-1],Y=t[C],A=Y.sampledZ;if(A==null){G.isHole||ce();continue}f++,d+=A,o=_e(o,A),a=U(a,A),G.isHole||Y.distance-G.start>=S?we(Y.distance,A):G.insert(A);const q=X.sampledZ;if(q!=null){const se=A-q;se>0?l+=se:se<0&&(c-=se)}}return ce(),f===0?null:{maxDistance:t[i-1].distance,minElevation:o,maxElevation:a,avgElevation:f===0?null:d/f,elevationGain:l,elevationLoss:c,maxPositiveSlope:p,maxNegativeSlope:h,avgPositiveSlope:_===0?null:m/_,avgNegativeSlope:v===0?null:y/v}}function xi(t){const e=t.filter(Ge),i=e.length;if(i===0)return null;const s=e[0];if(i===1)return s;let n=s.maxDistance,o=s.minElevation,a=s.maxElevation,l=s.maxPositiveSlope,c=s.maxNegativeSlope;for(let p=1;p<e.length;++p){const h=e[p];n=U(n,h.maxDistance),o=_e(o,h.minElevation),a=U(a,h.maxElevation),l=U(l,h.maxPositiveSlope),c=U(c,h.maxNegativeSlope)}return{maxDistance:n,minElevation:o,maxElevation:a,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:l,maxNegativeSlope:c,avgPositiveSlope:null,avgNegativeSlope:null}}function Ri(t){let e=null,i=null,s=null;for(const n of t){if(n==null)continue;const{statistics:o,spatialReference:a}=n;if(o==null)continue;const l=Q(a);e=U(e,he(o.maxDistance,l));const c=W(a);s=_e(s,he(o.minElevation,c)),i=U(i,he(o.maxElevation,c))}return{minDistance:0,maxDistance:e??0,minElevation:s??0,maxElevation:i??0}}function _e(t,e){return e==null?t:t!=null?Math.min(t,e):e}function U(t,e){return e==null?t:t!=null?Math.max(t,e):e}function he(t,e){return t!=null&&e!=null?t*e:null}let ke=class{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(e){this._start=e._start,this._sampleCount=e._sampleCount,this._totalElevation=e._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(e,i){this._start=e,this._sampleCount=1,this._totalElevation=i}insert(e){++this._sampleCount,this._totalElevation+=e}};function ki(t,e,i=[]){if(t>=e||(i.push(t),e-t<2))return i;const s=e-1;i.push(s);const n=me(t+1,s);for(;;){const o=n.next();if(o.done)break;i.push(o.value)}return i}function*me(t,e){if(t>=e)return;const i=t+Math.floor((e-t)/2);yield i;const s=me(t,i),n=me(i+1,e);for(;;){const o=s.next(),a=n.next();if(o.done&&a.done)break;o.done||(yield o.value),a.done||(yield a.value)}}async function*Ci(t,e){const{view:i,geometry:s,elevationInfo:n,providers:o,options:a}=t,l=i.spatialReference;if(!l||s==null||!Be(s))throw new We;const c=o.length;if(c===0)return null;const p=Math.round(a.maxTotalSamples/c);if(Xe(s)>p)throw new re;const h=await pi(s,n,i,l,a,p,e);M(e);let d=0;const m=new Array(c),y=new Array(c);for(let v=0;v<c;v++){const w=zi(h);m[v]=w,d+=w.samples.length;const x={...t,provider:o[v],result:w,densificationResult:h};y[v]=Vi(x,e)[Symbol.iterator]()}if(d>a.maxTotalSamples)throw new re;const f=await Promise.all(y.map(v=>{const w=v.next();return w.done===!0?Promise.resolve(null):w.value}));M(e);for(let v=0;v<c;v++)m[v]=f[v];yield m,await mt(t.delayAfterPreview??Z().delayAfterPreviewMillis,null,e.signal),M(e);const _=[];try{let v;do{v=!1;for(let w=0;w<c;w++){const x=y[w].next();x.done===!1&&(_.push({resultPromise:x.value,index:w}),v=!0)}}while(v)}finally{y.forEach(v=>v.return?.())}for(const{resultPromise:v,index:w}of _)m[w]=await v,M(e),yield m;for(const v of m)v!=null&&(v.progress=1);yield m}function*Vi(t,e){const{densificationResult:i}=t,s={...t,abortOptions:e,densificationResult:i},n=ki(0,s.result.samples.length),o=n.slice(0,s.provider.numSamplesForPreview);yield Ce(s,o,!0);const a=ft(n,s.provider.numSamplesPerChunk);for(const l of a)yield Ce(s,l,!1)}async function Ce({densificationResult:t,result:e,provider:i,queue:s,abortOptions:n,cache:o},a,l){const{densifiedPath:c,pathLength:p}=t,h=e.spatialReference,{samples:d}=e,m=[];for(let y=0;y<a.length;y++){const f=d[a[y]];m[y]=[...f.coordinate]}try{return await s.push({geometry:new gt({spatialReference:h,points:m,hasZ:c.hasZ}),provider:i,indices:a,preview:l,result:e,parameters:{...Z().defaultQueryOptions(),minDemResolution:Math.round(l?p/i.numSamplesForPreview:p/d.length),cache:o}},n),{...e}}catch(y){return _t(y)?null:li}}function Ii(t){return new pt({priority:ht.ELEVATION_PROFILE,concurrency:1,scheduler:t,process:async e=>{M(e.parameters);try{await Oi(e)}catch(i){dt(i)}}})}async function Oi({geometry:t,provider:e,indices:i,preview:s,result:n,parameters:o}){if(i.length===0)return;const a=(await Ai(e,t,o)).geometry,{hasZ:l,points:c}=a,p=o.noDataValue,{samples:h}=n;for(let d=0;d<i.length;d++){const m=h[i[d]];if(m.isHole)continue;const y=l?c[d][2]:null;y===null||y===p?m.sampledZ=null:(n.hasZ=!0,m.sampledZ=y),m.sampled=!0}Gi(h),n.progress=s?0:n.progress+i.length/h.length,n.statistics=Di(n.samples,n.spatialReference)}function Gi(t){const e=t.length-1;let i=0;for(let s=1;s<=e;s++)(t[s].sampled||s===e)&&(Ti(t,i,s),i=s)}function Ti(t,e,i){if(i-e===1)return;const s=t[e],n=s.sampledZ,o=t[i],a=o.sampledZ;if(n==null||a==null){for(let p=e+1;p<i;p++)t[p].sampledZ=null;return}const l=s.distance,c=o.distance-l;for(let p=e+1;p<i;p++){const h=t[p],d=(h.distance-l)/c;h.sampledZ=Oe(n,a,d)}}function zi({densifiedPath:t,distances:e}){const i=t.spatialReference,s=yt(i),n=t.paths,o=n.length,a=[];let l=null,c=0;for(let p=0;p<o;p++){const h=n[p],d=h.length,m=e[p];for(let y=0;y<d;y++){const f=h[y],_=m[y];s&&(f[0]=vt(f[0],s.valid[0],s.valid[1])),l&&y===0&&Mi(a,l,f,c,_),a.push(Li(f,_)),l=f,c=_}}return{progress:0,samples:a,hasZ:!1,statistics:null,spatialReference:i}}function Mi(t,e,i,s,n){t.push(Ve(e,s)),t.push(Ve(i,n))}function Li(t,e){return{coordinate:t,distance:e,sampledZ:null,sampled:!1,isHole:!1}}function Ve(t,e){return{coordinate:t,distance:e,sampledZ:null,sampled:!0,isHole:!0}}async function Ai(t,e,i){try{return await t.queryElevation(e,i)}catch{throw new ui}}function qi(t,e,i){if(!t||t.length===0)return;const s=t.length-1,n=t[0];if(e<=i(n))return n;const o=t[s];if(e>=i(o))return o;let a=0,l=0,c=s;for(;a<c;){l=a+Math.floor((c-a)/2);const p=t[l],h=i(p);if(h===e)return p;if(e<h){if(l>0){const d=t[l-1],m=i(d);if(e>m)return e-m>=h-e?p:d}c=l}else{if(l<s){const d=t[l+1],m=i(d);if(e<m)return e-h>=m-e?d:p}a=l+1}}return t[l]}function Ye(t){return t>.999999?1:t}function Ui(t,e){if(t==null||e==null)return null;const{samples:i,spatialReference:s}=t,{distance:n,elevation:o}=e,a=Q(s),l=W(s),c=i.length,p=new Array(c);for(let h=0;h<c;++h){const d=i[h],m=d.sampledZ,y=d.coordinate;p[h]={x:y[0],y:y[1],z:m,distance:et(d.distance,a,n),elevation:B(m,l,o)}}return p}function Zi(t,e){if(t==null||e==null||t.statistics==null||t.spatialReference==null)return null;const{distance:i,elevation:s}=e,{statistics:n,spatialReference:o}=t,a=Q(o),l=W(o);return{maxDistance:et(n.maxDistance,a,i),minElevation:B(n.minElevation,l,s),maxElevation:B(n.maxElevation,l,s),avgElevation:B(n.avgElevation,l,s),elevationGain:B(n.elevationGain,l,s),elevationLoss:B(n.elevationLoss,l,s),maxPositiveSlope:n.maxPositiveSlope,maxNegativeSlope:n.maxNegativeSlope,avgPositiveSlope:n.avgPositiveSlope,avgNegativeSlope:n.avgNegativeSlope}}function et(t,e,i){return t==null?null:le(t*e,"meters",i)}function B(t,e,i){return t==null?null:le(t*e,"meters",i)}let V=class extends wt{constructor(e){super(e),this._getSamplesMemoized=Pe((i,s)=>Ui(i,s)),this._getStatisticsMemoized=Pe((i,s)=>Zi(i,s)),this.rawResult=null}get available(){const{computation:e}=this;return e.profile.enabled&&e.available}get profile(){return this.computation.profile}get progress(){return Ye(this.rawResult!=null&&this.computation.profile.enabled?this.rawResult.progress:0)}get samples(){return this._getSamplesMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get statistics(){return this._getStatisticsMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get hoveredPoint(){if(!this.computation.profile.enabled)return null;const e=this.computation.controller.analysisViewData.hoveredPosition;if(e==null)return null;const{rawResult:i,samples:s}=this;if(s==null||i==null)return null;const n=s.length;if(n===0)return null;const o=s[n-1].distance,a=qi(s,e*o,h=>h.distance);if(a==null)return null;const{x:l,y:c,z:p}=a;return p==null?null:new bt({x:l,y:c,z:p,spatialReference:i.spatialReference})}};r([u()],V.prototype,"available",null),r([u({readOnly:!0})],V.prototype,"profile",null),r([u({readOnly:!0})],V.prototype,"progress",null),r([u()],V.prototype,"samples",null),r([u()],V.prototype,"statistics",null),r([u({constructOnly:!0})],V.prototype,"computation",void 0),r([u()],V.prototype,"rawResult",void 0),r([u()],V.prototype,"hoveredPoint",null),V=r([D("esri.views.analysis.ElevationProfile.ElevationProfileResult")],V);let $=class extends H{constructor(t){super(t),this.result=new V({computation:this}),this.numSamplesForPreview=30,this.numSamplesPerChunk=200}initialize(){this.addHandles([P(()=>{const{geometry:t,elevationInfo:e}=this.controller.analysis;return[t,e]},()=>this.onInvalidate(this),ue)])}setResult(t){this.result.rawResult=t}clearResult(){this.setResult(null)}get progress(){return this.result.progress}get hoveredPoint(){return this.result.hoveredPoint}get available(){return!0}get minDemResolution(){return Z().defaultDemResolution}};r([u({constructOnly:!0})],$.prototype,"controller",void 0),r([u({constructOnly:!0})],$.prototype,"profile",void 0),r([u({constructOnly:!0})],$.prototype,"onInvalidate",void 0),r([u()],$.prototype,"result",void 0),r([u({readOnly:!0})],$.prototype,"progress",null),r([u()],$.prototype,"hoveredPoint",null),r([u()],$.prototype,"available",null),r([u()],$.prototype,"numSamplesForPreview",void 0),r([u()],$.prototype,"numSamplesPerChunk",void 0),r([u({readOnly:!0})],$.prototype,"minDemResolution",null),$=r([D("esri.views.analysis.ElevationProfile.ElevationProfileLineComputation")],$);const Hi=2e5;let T=class extends ${constructor(){super(...arguments),this.type="scene",this.numSamplesForPreview=50,this.numSamplesPerChunk=25,this._getStableElevationDependencies=E(()=>{const e=this._view;return e?{view:e,stationary:e.stationary,geometry:this.controller?.analysis.geometry,visibleLayerIds:this._getStableLayerIds(),maxIntersectionDistance:this._maxIntersectionDistance,intersectOptions:this._intersectOptions,spatialReference:this._getStableSpatialReference()}:null},O),this._getStableSpatialReference=E(()=>this._view?.spatialReference,oe),this._getStableLayerIds=E(()=>Ne(this._view),O),this._getStablePointCloudLayers=E(()=>{const e=this._view;return e?e.allLayerViews.toArray().filter(i=>i.layer?.type==="point-cloud").map(i=>i.layer):[]},O),this._vecA=$e(),this._vecB=$e(),this._ray=Pt()}get minDemResolution(){const e=this._view;if(!e)return null;const i=e.pointsOfInterest?.focus?.worldUnitsPerContentPixel;return i==null?null:i*W(e.spatialReference)}initialize(){const e=()=>this.onInvalidate(this);return this.addHandles([P(()=>this._queryElevationDependencies,e,ue),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:i,signal:s}){const n=this._queryElevationDependencies;if(n==null)throw new Error(`${this.declaredClass}: no dependencies`);const o=this._intersector;if(o==null)throw new Error(`${this.declaredClass}: no view`);const{intersectOptions:a,view:l,spatialReference:c}=n,p=l.renderCoordsHelper,h=l.sceneIntersectionHelper,d=this._vecA,m=this._vecA,y=this._vecB,f=this._ray;if(!c)return{geometry:e,noDataValue:i};const _=await Te.fromGeometry(e).project(c,s);if(!_)return{geometry:e,noDataValue:i};const v=_.coordinates,w=v.length;for(let x=0;x<w;++x){const S=v[x];$t(y,S.x,S.y,S.z??0),p.toRenderCoords(y,c,y),p.setAltitude(d,Hi,y);const k=St(d,y,f);h.computeIntersection(k,o,!0,a);const L=Fi(n,o.results.all);L?(L.getIntersectionPoint(m),p.fromRenderCoords(m,m,c),S.z=m[2]):S.z=i}return{geometry:_.export(),noDataValue:i}}get _queryElevationDependencies(){return this._getStableElevationDependencies()}get _intersectOptions(){const e=this._view;if(!e||e.destroyed)return{};const{include:i,exclude:s}=this.profile;return Et(e,{include:i,exclude:[...this._pointCloudLayers,...Dt(s)?s:s?[s]:[]]})}get _pointCloudLayers(){return this._getStablePointCloudLayers()}get _view(){const e=this.controller.view;return e.type==="3d"?e:null}get _maxIntersectionDistance(){const e=this._view;return e?.renderCoordsHelper?xt(e.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY}get _intersector(){const e=this._view;if(!e)return null;const i=new Rt(e.state.viewingMode),s=i.options;return s.hud=!1,s.invisibleTerrain=!1,s.backfacesTerrain=!1,s.selectionMode=!1,s.store=2,i}};function Fi({intersectOptions:t,maxIntersectionDistance:e,view:i},s){const n=t.graphics,o=!(!n?.include&&!n?.exclude);for(const a of s)if(a.withinDistance(e)){if(o){const l=kt(a,i);if(l!=null&&!Ct(n,l))continue}return a}return null}r([u({readOnly:!0})],T.prototype,"minDemResolution",null),r([u()],T.prototype,"_queryElevationDependencies",null),r([u()],T.prototype,"_intersectOptions",null),r([u()],T.prototype,"_pointCloudLayers",null),r([u()],T.prototype,"_view",null),r([u()],T.prototype,"_maxIntersectionDistance",null),r([u()],T.prototype,"_intersector",null),T=r([D("esri.views.3d.analysis.ElevationProfile.ElevationProfileLineSceneComputation")],T);function Ni(t){return ze([P(()=>{const{analysis:e,sketchGraphic:i,toolState:s,visible:n}=t.analysisViewData,{geometryVisualizationVisible:o}=e.viewOptions;return{geometryVisualizationVisible:o,geometry:e.geometry,sketchGraphic:i,toolState:s,visible:n}},({geometryVisualizationVisible:e,sketchGraphic:i,toolState:s,visible:n})=>{if(t.remove(),n)return e&&i!=null&&s!=="reshaping"&&s!=="sketching"?t.show(i):void 0},R)])}let J=class extends H{constructor(e){super(e),this._visualElementHandle=null}initialize(){this._settings=new ii({getTheme:()=>this.view.effectiveTheme}),this.addHandles(Ni({analysisViewData:this.analysisViewData,remove:()=>this._remove(),show:e=>this._show(e)}))}destroy(){this._remove()}get updating(){return!1}_remove(){this._visualElementHandle=Vt(this._visualElementHandle)}_show(e){this._remove();const{view:i}=this,s=new He({view:i,geometry:this.analysisViewData.analysis.geometry,attached:!1,renderOccluded:8,isDecoration:!0}),n=[P(()=>this.analysisViewData.analysis.elevationInfo,o=>{s.elevationInfo=o,s.isDraped=It(!0,o)==="on-the-ground"},R),P(()=>this.analysisViewData.analysis.geometry,o=>{s.geometry=o}),i.maskOccludee(e),Ot(s)];this._settings.visualElements.lineObjects.outline.apply(s),s.attached=!0,this._visualElementHandle=ze(n)}};r([u({constructOnly:!0})],J.prototype,"view",void 0),r([u({constructOnly:!0})],J.prototype,"analysisViewData",void 0),r([u()],J.prototype,"updating",null),J=r([D("esri.views.3d.analysis.ElevationProfile.ElevationProfileGeometryVisualization3D")],J);function ji(t,e){t??=[];const i=t.length-1,s=[];let n=[];for(let o=0;o<=i;o++){const{x:a,y:l,z:c}=t[o];c!=null&&n.push([a,l,c]),o!==i&&c!=null||!n.length||(s.push(n),n=[])}return si(s,e,!0)}let z=class extends H{constructor(t){super(t),this._updateGeometryThrottled=Fe(e=>{if(!e)return;const{samples:i,spatialReference:s}=e,n=i!=null&&i.length>0;this._visualElement.geometry=n?ji(i,s):null},Z().profileLinesUpdateThrottleMillis)}initialize(){this._visualElement=new He({view:this.view,elevationInfo:Me,innerWidth:0,innerColor:Gt(0,0,0,0),width:3,falloff:0,renderOccluded:16,isDecoration:!0}),this.addHandles([P(()=>({color:this._result?.computation.profile.color,visible:this._effectiveVisible}),({color:t,visible:e})=>{t&&(this._visualElement.color=Tt(ve.toUnitRGBA(t))),this._visualElement.visible=e},R),P(()=>this.analysisViewData.analysis.geometry,()=>{this._visualElement.geometry=null},R),P(()=>this._geometryUpdateParameters,t=>this._updateGeometryThrottled(t),R),this._updateGeometryThrottled])}destroy(){this._visualElement.destroy()}get updating(){return this._updateGeometryThrottled.hasPendingUpdates()}get _result(){return this.getResult()}get _effectiveVisible(){const{analysisViewData:t,_result:e}=this;return t.visible&&e!=null&&e.available&&e.computation.profile.viewOptions.lineVisible}get _geometryUpdateParameters(){return this._effectiveVisible&&this.analysisViewData.progress!==1?null:{samples:this._result?.samples,spatialReference:this.view.spatialReference}}};r([u()],z.prototype,"view",void 0),r([u()],z.prototype,"analysisViewData",void 0),r([u()],z.prototype,"getResult",void 0),r([u()],z.prototype,"updating",null),r([u()],z.prototype,"_result",null),r([u()],z.prototype,"_effectiveVisible",null),r([u()],z.prototype,"_geometryUpdateParameters",null),z=r([D("esri.views.3d.analysis.ElevationProfile.ElevationProfileLineVisualization3D")],z);let F=class extends H{constructor(e){super(e),this.position=null,this.color=new ve("#ffffff"),this.element=Wi()}initialize(){this.addHandles([P(()=>this._screenLocation,e=>{e&&(this.element.style.transform=`translate(${e.x}px, ${e.y}px)`)},R),P(()=>this.color.toCss(),e=>{this.element.style.background=e},R)]),this.view.surface?.appendChild(this.element)}destroy(){this.element.remove()}get _screenLocation(){const{position:e,view:i}=this;i.type==="3d"?(i.commitProperty("size"),i.commitProperty("camera")):i.commitProperty("center");const s=i?.spatialReference,n=s?zt(e,s).geometry:null;return n&&i?.ready?i.toScreen(n):null}};function Wi(){const t=document.createElement("div"),{size:e,borderStyle:i,borderColor:s,borderWidth:n,boxShadow:o}=Z().hoveredPointsStyle,{style:a}=t;return a.display="block",a.position="absolute",a.top="0",a.left="0",a.contain="strict",a.boxSizing="border-box",a.width=`${e}px`,a.height=`${e}px`,a.marginTop=`-${e/2}px`,a.marginLeft=`-${e/2}px`,a.border=`${i} ${n}px ${s}`,a.borderRadius=`${e}px`,a.boxShadow=o,t}r([u()],F.prototype,"position",void 0),r([u({type:ve})],F.prototype,"color",void 0),r([u()],F.prototype,"view",void 0),r([u()],F.prototype,"_screenLocation",null),F=r([D("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointVisualization")],F);let N=class extends H{constructor(e){super(e),this._hoveredPoints=new Le}initialize(){const{analysisViewData:e}=this,{analysis:i}=e;this.addHandles([P(()=>{const{hoveredPoints:s,visible:n,updating:o}=e;return n?o?null:s.map((a,l)=>{const c=i.profiles.at(l);return c?.viewOptions.hoveredPointVisible===!0&&a!=null?{hoveredPoint:a,color:c.color}:null}).filter(a=>!!a):[]},s=>this._update(s),R),P(()=>i.geometry,()=>this._update([]),R)])}destroy(){this._hoveredPoints.drain(e=>e.destroy())}get updating(){return!1}_update(e){if(!e)return;const{view:i,_hoveredPoints:s}=this,n=e.length;for(;s.length>n;)s.pop()?.destroy();for(;s.length<n;){const o=new F({view:i});s.push(o)}for(let o=0;o<n;++o){const a=e[o],l=s.at(n-1-o);l.position=a.hoveredPoint,l.color=a.color}}};r([u()],N.prototype,"view",void 0),r([u()],N.prototype,"analysisViewData",void 0),r([u()],N.prototype,"_hoveredPoints",void 0),r([u()],N.prototype,"updating",null),N=r([D("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointsVisualization")],N);let K=class extends H{constructor(t){super(t)}initialize(){const{view:t,analysisViewData:e}=this;this._hoveredPointsVisualization=new N({view:t,analysisViewData:e}),this._geometryVisualization=new J({view:t,analysisViewData:e}),this._lineVisualizations=Ae(()=>this.analysisViewData.analysis.profiles,i=>new z({view:t,analysisViewData:e,getResult:()=>e.results.find(s=>s.computation.profile===i)}))}destroy(){this._geometryVisualization.destroy(),this._hoveredPointsVisualization.destroy(),this._lineVisualizations.destroy()}get updating(){return this._geometryVisualization.updating||this._lineVisualizations.some(t=>t.updating)}};r([u()],K.prototype,"view",void 0),r([u()],K.prototype,"analysisViewData",void 0),r([u()],K.prototype,"updating",null),K=r([D("esri.views.3d.analysis.ElevationProfile.ElevationProfileVisualization3D")],K);let g=class extends H{constructor(t){super(t),this.error=null,this._getStableEffectiveUnits=E(()=>{const e=Ri(this._activeComputations.map(n=>n.result.rawResult)),i=this.analysis.displayUnits,s=ni(this.view);return{distance:Ht(e.maxDistance,"meters",i.distance??s),elevation:Zt(e.maxElevation,"meters",i.elevation??s)}},O),this._updateTask=null,this._queue=null,this._currentTileCache=null,this._parametersPerComputation=new Map,this._getStableUpdateParameters=E(()=>({stationary:this.view.stationary??!0,activeComputations:this._activeComputations,generationParameters:this._generationParameters}),O),this._getStableGenerationParameters=E(()=>{const{view:e,analysis:i}=this;return e?.ready&&this._queue?{view:e,geometry:i.geometry,geometryIsValid:i.valid,elevationInfo:this.elevationInfo,queue:this._queue,cache:this._tileCache,options:this._options,slicePlane:e.type==="3d"?e.slice.plane:null}:null},O),this._getStableElevationInfo=E(()=>this.analysis.elevationInfo??Qi,oe),this._getStableOptions=E(()=>{const{densificationMaxSamples:e,defaultDemResolution:i,maxTotalSamples:s}=Z();let n=this._minDemResolution??i;return n=parseFloat(n.toFixed(2)),{samplingDistance:n,densificationMaxSamples:Math.round(e/this._activeComputations.length),maxTotalSamples:s}},O),this._updateThrottled=Fe(e=>this._update(e),Z().updateThrottleMillis)}initialize(){this._computationsCollection=Ae(()=>this.analysis.profiles,e=>this.computationFactory.create({controller:this,profile:e,onInvalidate:i=>this._invalidateComputation(i)}),{recycleItems:!0}),this.addHandles([this._computationsCollection.on("change",()=>{this._parametersPerComputation.clear(),this._updateThrottled(this._updateParameters)}),P(()=>this._updateParameters,e=>this._updateThrottled(e),R),this._updateThrottled]);const t=this.view.type==="3d"?this.view.resourceController:void 0;this._queue=Ii(t?.scheduler),t?.addUpdatingObject(this)}destroy(){this._abortUpdate(),this._parametersPerComputation.clear(),this._computationsCollection?.destroy(),this._queue=ne(this._queue),this._currentTileCache=ne(this._currentTileCache)}get effectiveDisplayUnits(){return this._getStableEffectiveUnits()}get progress(){let t=0,e=0;for(const i of this._activeComputations)t++,e+=i.progress;return Ye(t>0?e/t:0)}get updating(){const{progress:t}=this,e=!!this._queue?.updating,i=this._updateThrottled.hasPendingUpdates(),s=this._updateTask!=null&&!this._updateTask.finished;return e||i||s||t>0&&t<1}get results(){return this._computations.map(t=>t.result)}get statistics(){return xi(this._activeComputations.map(t=>t.result.statistics))}get hoveredPoints(){return this._computations.map(t=>t.hoveredPoint)}onElevationChange(t){const{view:e}=this;return e?.type==="3d"?Mt(()=>e.elevationProvider,"elevation-change",t,{onListenerAdd:t,onListenerRemove:t}):ee()}get _tileCache(){this._currentTileCache=ne(this._currentTileCache);const t=this.view;if(t?.type==="3d"){const e=t.basemapTerrain?.elevationQueryCache;if(e!=null)return e}return this._currentTileCache==null&&(this._currentTileCache=new Lt(new At(20971520))),this._currentTileCache}get _computations(){return this._computationsCollection?.toArray()??[]}get _activeComputations(){return this._computations.filter(t=>t.profile.enabled&&t.available)}get _minDemResolution(){const t=this._minDemResolutions;return t.length>0?qe(t):null}get _minDemResolutions(){const t=[];for(const{minDemResolution:e}of this._activeComputations)e!=null&&t.push(e);return t}get _updateParameters(){return this._getStableUpdateParameters()}get _generationParameters(){return this._getStableGenerationParameters()}get elevationInfo(){return this._getStableElevationInfo()}get _options(){return this._getStableOptions()}_update({stationary:t,activeComputations:e,generationParameters:i}){this._abortUpdate(),t&&(i!=null?this._updateTask=Ue(async s=>{this.error=null;const n=e.filter(o=>!this._isComputationValid(o,i));try{if(!i.geometryIsValid)throw new We;const o=Ci({...i,providers:n},{signal:s});let a=!1;for await(const l of o){M(s),a||(this._clearInvalidResults(i),a=!0);for(let c=0;c<n.length;c++)n[c].setResult(l[c])}for(const l of n)this._parametersPerComputation.set(l,i)}catch(o){qt(o),this._abortUpdate(),this.error=o instanceof ie?o:new ci,n.forEach(a=>{a.clearResult()})}}):this._clearResults())}_abortUpdate(){this._updateTask=Ut(this._updateTask)}_isComputationValid(t,e){return this._parametersPerComputation.has(t)&&this._parametersPerComputation.get(t)===e}_invalidateComputation(t){this._parametersPerComputation.delete(t),this._updateThrottled(this._updateParameters)}_clearInvalidResults(t){for(const e of this._computations)this._isComputationValid(e,t)||(e.clearResult(),this._parametersPerComputation.delete(e))}_clearResults(){for(const t of this._computations)t.clearResult(),this._parametersPerComputation.delete(t)}};r([u({constructOnly:!0})],g.prototype,"analysis",void 0),r([u({constructOnly:!0})],g.prototype,"analysisViewData",void 0),r([u({constructOnly:!0})],g.prototype,"computationFactory",void 0),r([u({constructOnly:!0})],g.prototype,"view",void 0),r([u()],g.prototype,"error",void 0),r([u({readOnly:!0})],g.prototype,"effectiveDisplayUnits",null),r([u()],g.prototype,"progress",null),r([u()],g.prototype,"updating",null),r([u()],g.prototype,"results",null),r([u()],g.prototype,"statistics",null),r([u()],g.prototype,"hoveredPoints",null),r([u()],g.prototype,"_updateTask",void 0),r([u()],g.prototype,"_queue",void 0),r([u()],g.prototype,"_tileCache",null),r([u()],g.prototype,"_computationsCollection",void 0),r([u()],g.prototype,"_computations",null),r([u()],g.prototype,"_activeComputations",null),r([u({readOnly:!0})],g.prototype,"_minDemResolution",null),r([u()],g.prototype,"_minDemResolutions",null),r([u()],g.prototype,"_updateParameters",null),r([u()],g.prototype,"_generationParameters",null),r([u()],g.prototype,"elevationInfo",null),r([u()],g.prototype,"_options",null),g=r([D("esri.views.analysis.ElevationProfile.ElevationProfileController")],g);const Qi=new fe({...Me});function tt(t){if(t==null)return null;if(Ft(t))return it(t);const e=t.tileInfo;if(e==null)return null;const i=e.lods?.at(-1);return i==null?null:i.resolution*Q(e.spatialReference)}function it(t){if(t==null)return null;const e=t.layers.items.map(Bi).filter(Ge);return qe(e)??null}function Bi(t){return t&&"tileInfo"in t?tt(t):null}let j=class extends ${constructor(){super(...arguments),this.type="ground",this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getStableQueryElevationDependencies=E(()=>({ground:this._ground,groundLayers:this._getStableGroundLayers()}),O),this._getStableGroundLayers=E(()=>this._ground?.layers?.toArray(),O)}get minDemResolution(){return it(this._ground)}get available(){return this._ground?.layers.some(e=>e.visible)===!0}initialize(){this.addHandles([P(()=>this._queryElevationDependencies,()=>this.onInvalidate(this))])}async queryElevation(e,i){const s=this._queryElevationDependencies;if(s==null)throw new Error(`${this.declaredClass}: no dependencies`);const{ground:n}=s;if(n==null)throw new Error("No ground configured in the view");const o=await n.queryElevation(e,i),a=W(e.spatialReference),l=W(n.layers.at(0).spatialReference);if(a!==l){const c=o.geometry;c.points=c.points.map(([p,h,d])=>[p,h,d===i.noDataValue?d:d*l/a])}return o}get _queryElevationDependencies(){return this._getStableQueryElevationDependencies()}get _ground(){return this.controller.view?.map?.ground}};r([u()],j.prototype,"minDemResolution",null),r([u()],j.prototype,"available",null),r([u()],j.prototype,"_queryElevationDependencies",null),r([u()],j.prototype,"_ground",null),j=r([D("esri.views.analysis.ElevationProfile.ElevationProfileLineGroundComputation")],j);let ae=class extends ${constructor(){super(...arguments),this.type="input",this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this._getStableElevationDependencies=E(()=>{const{view:e}=this.controller;if(!e)return null;const i=this._getStableElevationInfo();return{view:e,stationary:!this._requiresElevationAlignment||e.stationary,elevationInfo:i,visibleLayerIds:this._getStableLayerIds(),spatialReference:this._getStableSpatialReference()}},O),this._getStableElevationInfo=E(()=>this.controller.elevationInfo,oe),this._getStableSpatialReference=E(()=>this.controller.view?.spatialReference,oe),this._getStableLayerIds=E(()=>{const{view:e}=this.controller;return e.type!=="3d"?[]:Ne(e)},O)}initialize(){const e=()=>this.onInvalidate(this);this.addHandles([P(()=>this._queryElevationDependencies,e,ue),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:i,signal:s}){const n=this._queryElevationDependencies;if(n==null)throw new Error(`${this.declaredClass}: no dependencies`);const{view:o,spatialReference:a}=n;if(this._requiresElevationAlignment&&o.type==="3d"&&a){const l=await Te.fromGeometry(e).project(a,s);if(!l)return{geometry:e,noDataValue:i};const c=o.elevationProvider;return l.coordinates.forEach(p=>{p.z=c.getElevation(p.x,p.y,0,a,"ground")??0}),{geometry:l.export(),noDataValue:i}}return{geometry:e,noDataValue:i}}get _requiresElevationAlignment(){return this.controller.elevationInfo?.mode==="on-the-ground"&&this.controller.view.type==="3d"}get _queryElevationDependencies(){return this._getStableElevationDependencies()}};r([u()],ae.prototype,"_queryElevationDependencies",null),ae=r([D("esri.views.analysis.ElevationProfile.ElevationProfileLineInputComputation")],ae);let te=class extends ${constructor(){super(...arguments),this.type="query",this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return tt(this.profile.source)}get available(){const{source:t}=this.profile;return!!t&&(t.visible==null||t.visible)&&(t.layers==null||t.layers.some(e=>e.visible))}initialize(){this.addHandles(P(()=>this.profile.source,()=>this.onInvalidate(this),ue))}queryElevation(t,e){if(!this.profile.source)throw new Error("No source configured for the elevation profile line");return this.profile.source.queryElevation(t,e)}};r([u({readOnly:!0})],te.prototype,"minDemResolution",null),r([u()],te.prototype,"available",null),te=r([D("esri.views.analysis.ElevationProfile.ElevationProfileLineQueryComputation")],te);let I=class extends H{constructor(t){super(t),this._sketchViewModels=new Le,this._updatingHandles=new Nt,this._operationManager=new oi}initialize(){const{view:t}=this;this._graphicsLayer=new ai({listMode:"hide",internal:!0}),this.addHandles([P(()=>({map:t.map,internalGraphicsLayer:this._graphicsLayer,state:this.state,geometryVisualizationVisible:this._analysis.viewOptions.geometryVisualizationVisible,visible:this.analysisViewData.visible}),({map:e,internalGraphicsLayer:i,state:s,geometryVisualizationVisible:n,visible:o})=>{Ki(e,i);const a=this.sketchGraphic;switch(a&&(a.visible=o),s){case"idle":case"reshaping-disabled":a&&!n&&(a.visible=!1),this._operationManager.stop(),this._ensureUpdatedSketchGraphic();break;case"reshaping":pe(this._startReshape());break;case"awaiting-sketch":this.analysisViewData.interactive=!0}},R),P(()=>this._analysis.elevationInfo,e=>{this._graphicsLayer.elevationInfo=e},R)])}destroy(){this._operationManager.destroy(),this._sketchViewModels.drain(e=>ne(e));const t=this._graphicsLayer;this.view.map?.remove(t),t.destroy()}get sketchGraphic(){return this._get("sketchGraphic")}set sketchGraphic(t){t!==this._get("sketchGraphic")&&(this._set("sketchGraphic",t),this._updateAnalysisFromSketchGraphic())}get state(){const{visible:t,interactive:e}=this.analysisViewData;if(!t)return"idle";switch(this._operationManager.currentOperationType){case"place":return this._sketching?"sketching":"awaiting-sketch";case"pick-feature":return"picking";default:return this._analysis.geometry?e?"reshaping":"reshaping-disabled":"idle"}}get updating(){return this._sketchViewModels.some(t=>t.updating)||this._updatingHandles.updating}get _sketching(){return this._sketchViewModels.some(t=>t.createGraphic===this.sketchGraphic)}get _analysis(){return this.analysisViewData.analysis}get _lineSymbol(){return Ji(this.view.type)}place(t){return this._operationManager.start("place",async e=>{const i=this._createSketchViewModel(),s=this._analysis.clone();this._ensureUpdatedSketchGraphic();const n=this.sketchGraphic,o=this._analysis.elevationInfo,a=ee(()=>{this.sketchGraphic===n&&(this._graphicsLayer.elevationInfo=o)}),l=i.on("create",c=>{switch(c.state){case"start":this._graphicsLayer.removeAll(),this.sketchGraphic=c.graphic,this._analysis.elevationInfo=this._graphicsLayer.elevationInfo;break;case"active":this._updateAnalysisFromSketchGraphic();break;case"complete":this.sketchGraphic&&(this._updateAnalysisFromSketchGraphic(),this._addSketchGraphic(this.sketchGraphic)),e.stop();break;case"cancel":e.stop()}});e.handles.push(l,ee(()=>(l.remove(),i.destroy(),this._sketchViewModels.remove(i),this._updateAnalysisFromSketchGraphic(),this._analysis.valid?jt(t)||s.equals(this._analysis)?e.reject():void e.resolve({}):(this._clear(),e.reject()))),a),this._graphicsLayer.elevationInfo=Xi,await this._updatingHandles.addPromise(pe(i.create("polyline")))},t)}async pickFeature(t){return this._operationManager.start("pick-feature",async e=>{const{view:i}=this;i.closePopup();let s=null;const n=a=>{a.defer(async()=>{s?.abort(),s=Ue(async l=>{const{results:c}=await i.hitTest(a);M(l);let p=null;for(const h of c)if(h.type==="graphic"&&mi(h.graphic)&&!vi(h.graphic)){p=h.graphic;break}p?(a.preventDefault(),a.stopPropagation(),this.sketchGraphic=null,this._analysis.geometry=p.geometry,this._analysis.elevationInfo=new fe({...Qt(p)}),e.resolve({feature:p}),e.stop()):e.reject()}),await s.promise})},o=a=>{Bt(a)&&(e.reject(),e.stop())};e.handles.push(i.on("immediate-click",n,Se.TOOL),i.on("key-down",o,Se.TOOL),i.acquireCursor("crosshair","high"),ee(()=>{s?.abort(),e.reject()})),i.focus()},t)}_startReshape(){const t=this._createSketchViewModel();return this._sketchViewModels.add(t),this._operationManager.start("reshape",async e=>{const i=()=>{const n=this._ensureUpdatedSketchGraphic();return n?this._updatingHandles.addPromise(t.update(n,{tool:"reshape"})):Promise.resolve()};if(!this._ensureUpdatedSketchGraphic())return;const s=t.on("update",n=>{this._updateAnalysisFromSketchGraphic(),n.state==="complete"&&(this.state==="reshaping"?pe(i()):e.resolve())});e.handles.push(s,ee(()=>{s.remove(),this._sketchViewModels.remove(t),t.destroy(),e.resolve()})),await i()})}_createSketchViewModel(){return new ri({layer:this._graphicsLayer,view:this.view,defaultCreateOptions:{mode:"click",hasZ:!0},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{shapeOperation:"none"},toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:this._lineSymbol,activeLineSymbol:this._lineSymbol})}_ensureUpdatedSketchGraphic(){const{geometry:t}=this._analysis;if(!t)return this.sketchGraphic=null,this._graphicsLayer.removeAll(),null;const e=this.sketchGraphic??=new Wt({symbol:this._lineSymbol,geometry:t});return e.geometry=t,this._addSketchGraphic(e),e}_addSketchGraphic(t){const{graphics:e}=this._graphicsLayer;e.includes(t)||e.add(t),e.length!==1&&e.removeMany(e.filter(i=>i!==t))}_clear(){this.sketchGraphic=null,this._analysis.clear()}_updateAnalysisFromSketchGraphic(){let t=this.sketchGraphic?.geometry;ge(t)||(t=null);const e=this._analysis;e.geometry!==t&&(e.geometry=t)}};function Ji(t){if(t==="2d"){const e={type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5};return new Jt({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{...e,effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],color:[0,0,0,255]},{...e,color:[255,255,255,255]}]}}})}return new Kt({color:[0,0,0,0]})}function Ki(t,e){e&&(e.removeFromParent(),t?.add(e))}r([u({constructOnly:!0})],I.prototype,"analysisViewData",void 0),r([u({constructOnly:!0})],I.prototype,"view",void 0),r([u()],I.prototype,"sketchGraphic",null),r([u({nonNullable:!0})],I.prototype,"state",null),r([u()],I.prototype,"updating",null),r([u()],I.prototype,"_sketching",null),r([u()],I.prototype,"_analysis",null),r([u()],I.prototype,"_lineSymbol",null),I=r([D("esri.views.analysis.ElevationProfile.ElevationProfileTool")],I);const Xi=new fe({mode:"on-the-ground",offset:0});let b=class extends Xt{constructor(t){super(t),this.type="elevation-profile-view-3d",this.analysis=null,this.hoveredPosition=null}initialize(){const{analysis:t,view:e}=this;this._controller=new g({analysis:t,analysisViewData:this,view:e,computationFactory:{create:i=>{switch(i.profile.type){case"ground":return new j(i);case"input":return new ae(i);case"query":return new te(i);case"scene":return new T(i)}}}}),this._visualization=new K({view:e,analysisViewData:this}),this._sketchTool=new I({view:e,analysisViewData:this})}destroy(){this._controller?.destroy(),this._visualization?.destroy(),this._sketchTool?.destroy()}get effectiveDisplayUnits(){return this._controller?.effectiveDisplayUnits??{distance:"meters",elevation:"meters"}}get error(){return this._controller?.error}get hoveredPoints(){return this._controller?.hoveredPoints??[]}get interactive(){return super.interactive}set interactive(t){super.interactive=t}get progress(){return this._controller?.progress??0}get results(){return this._controller?.results??[]}get statistics(){return this._controller?.statistics}get updating(){return this._controller?.updating===!0||this._visualization?.updating===!0||this._sketchTool?.updating===!0}get visible(){return super.visible}set visible(t){super.visible=t}get sketchGraphic(){return this._sketchTool?.sketchGraphic}get toolState(){return this._sketchTool?.state??"idle"}place(t){return this._sketchTool.place(t)}pickFeature(t){return this._sketchTool.pickFeature(t)}};r([u({readOnly:!0})],b.prototype,"type",void 0),r([u({constructOnly:!0,nonNullable:!0})],b.prototype,"analysis",void 0),r([u({readOnly:!0})],b.prototype,"effectiveDisplayUnits",null),r([u({readOnly:!0})],b.prototype,"error",null),r([u()],b.prototype,"hoveredPosition",void 0),r([u()],b.prototype,"hoveredPoints",null),r([u({readOnly:!0})],b.prototype,"progress",null),r([u({readOnly:!0})],b.prototype,"results",null),r([u({readOnly:!0})],b.prototype,"statistics",null),r([u({readOnly:!0})],b.prototype,"updating",null),r([u()],b.prototype,"sketchGraphic",null),r([u()],b.prototype,"toolState",null),r([u()],b.prototype,"_controller",void 0),r([u()],b.prototype,"_visualization",void 0),r([u()],b.prototype,"_sketchTool",void 0),b=r([D("esri.views.3d.analysis.ElevationProfileAnalysisView3D")],b);const Ks=b;export{Ks as default};

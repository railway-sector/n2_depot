import{iu as B,ks as W,it as Q,iv as V,iw as X,dq as Y,kt as tt,ku as et,kv as nt,kw as b,kx as st,ky as A,kz as z,kA as at,kB as it,kC as N,kD as U,ac as Z,kE as F,cj as w,kF as ot,kG as rt,s as ht,kH as j,kI as lt,kJ as ct,kK as ut,kL as pt,kM as dt,kN as $}from"./index-B9VIL3e7.js";const _={maxSegmentLength:1/0,maxDeviation:1/0,maxSegmentsPerCurve:12e3,minSegmentsPerCurve:1},D=1e-6,mt=[0,0];function gt(e){return{maxSegmentLength:e.maxSegmentLength??_.maxSegmentLength,maxDeviation:e.maxDeviation??_.maxDeviation,maxSegmentsPerCurve:e.maxSegmentsPerCurve??_.maxSegmentsPerCurve,minSegmentsPerCurve:Math.max(e.minSegmentsPerCurve??_.minSegmentsPerCurve,1)}}let O=class{constructor(t,n){this.curveStart=t,this.curveEnd=n,this.tStart=0,this.tEnd=0,this.tEndStack=[],this.arcEndStack=[]}get stackSize(){return this.tEndStack.length}initialize(t,n){this.tStart=0,this.arcStart=t,this.tEndStack.push(1),this.arcEndStack.push(n)}splitAt(t){this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this.tEndStack.push(t),this.arcEndStack.push(this.interpolate(t))}splitInHalf(){return this.splitAt((this.tStart+this.tEnd)/2)}pop(){this.tEnd=this.tEndStack.pop(),this.arcEnd=this.arcEndStack.pop()}next(){this.tStart=this.tEnd,this.arcStart=this.arcEnd}densify(t,{maxDeviation:n,maxSegmentLength:s,maxSegmentsPerCurve:h,minSegmentsPerCurve:i}){const c=s*s,o=n*n,a=1/h,p=this.interpolate(0),u=this.interpolate(1);z(this.curveStart,p)>D&&t.push(p),this.initialize(p,u);const m=1/i;for(let r=i-1;r>0;r--){const l=r*m;this.pop(),this.splitAt(l)}for(;this.stackSize>0;)this.pop(),this.tStart===this.tEnd||this.tEnd-this.tStart<a||(c===0||!isFinite(c)||z(this.arcStart,this.arcEnd)<c)&&(o===0||!isFinite(o)||this.getDeviation2()<o)?(t.push(this.arcEnd),this.next()):this.splitInHalf();return z(this.curveEnd,u)>D&&t.push([...this.curveEnd]),t}},ft=class extends O{constructor(t,n){const[s,h,i]=n.b;super(t,s),this._controlPointsStack=[],this._curveControlPoints=[h,i],this._arcControlPoints=[h,i],this._controlPointsStack.push(this._arcControlPoints)}splitAt(t){const{arcStart:n,arcEnd:s,tStart:h,tEnd:i}=this,[c,o]=this._arcControlPoints,a=(t-h)/(i-h),p=b([],n,c,a),u=b(mt,c,o,a),m=b([],o,s,a),r=b([],p,u,a),l=b([],u,m,a),k=b([],r,l,a);this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this._controlPointsStack.push([l,m]),this.tEndStack.push(t),this.arcEndStack.push(k),this._arcControlPoints[0]=p,this._arcControlPoints[1]=r,this._controlPointsStack.push(this._arcControlPoints)}pop(){super.pop(),this._arcControlPoints=this._controlPointsStack.pop()}interpolate(t){const{curveStart:n,curveEnd:s}=this,[h,i]=this._curveControlPoints;return st(n,h,i,s,t)}getDeviation2(){const{arcStart:t,arcEnd:n}=this,[s,h]=this._arcControlPoints;return Math.max(A(s,t,n),A(h,t,n))}},yt=class extends O{constructor(t,n){const[s]=n.a;super(t,s),this._derivedEllipse=at(t,n)}pop(){super.pop(),this._tMid=(this.tStart+this.tEnd)/2,this._arcMid=this.interpolate(this._tMid)}splitInHalf(){this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this.tEndStack.push(this._tMid),this.arcEndStack.push(this._arcMid)}interpolate(t){return it(this._derivedEllipse,t)}getDeviation2(){return A(this._arcMid,this.arcStart,this.arcEnd)}};function G(e,t,n,{cx:s,cy:h,radius:i,thetaStart:c,thetaEnd:o,isInvalid:a},{maxDeviation:p,maxSegmentLength:u,maxSegmentsPerCurve:m,minSegmentsPerCurve:r}){if(a)return e.push([...n]),e;const l=2*i,k=[s+i*Math.cos(c),h+i*Math.sin(c)],f=[s+i*Math.cos(o),h+i*Math.sin(o)];z(t,k)>D&&e.push(k);const g=Math.abs(o-c),d=u<l?2*Math.asin(u/l):g,v=p<=i?2*Math.acos(1-p/i):g,y=Math.min(d,v),S=Math.min(m,Math.max(r,Math.ceil(Math.abs(g/y)))),x=1/S;for(let M=1;M<S;M++){const E=M*x,C=c*(1-E)+o*E;e.push([s+i*Math.cos(C),h+i*Math.sin(C)])}return e.push(f),z(n,f)>D&&e.push([...n]),e}function St(e,t,n,s){return new ft(t,n).densify(e,s)}function kt(e,t,n,s){const h=et(t,n),[i]=n.c;return G(e,t,i,h,s)}function vt(e,t,n,s){const h=nt(t,n),[i]=n.a;return G(e,t,i,h,s)}function xt(e,t,n,s){const[h,i,c,o,a,p,u]=n.a;return p===0||u===0?(e.push([...h]),e):new yt(t,n).densify(e,s)}function Mt(e,t,n,s){return V(n)?(e.push([...n]),e):X(n)?St(e,t,n,s):Y(n)?kt(e,t,n,s):tt(n)?vt(e,t,n,s):xt(e,t,n,s)}function R(e,t){if(!B(e))return e;const n=gt(t),s=W(e),h=[];for(const i of s){const c=[];for(let o=0;o<i.length-1;o++){const a=o+1,p=[...Q(i[o])];o===0&&c.push(p),Mt(c,p,i[a],n)}h.push(c)}return"curvePaths"in e?{...e.hasZ!==void 0?{hasZ:e.hasZ}:{},...e.hasM!==void 0?{hasM:e.hasM}:{},paths:h,spatialReference:e.spatialReference}:{...e.hasZ!==void 0?{hasZ:e.hasZ}:{},...e.hasM!==void 0?{hasM:e.hasM}:{},rings:h,spatialReference:e.spatialReference}}const J="picture-fill",wt="picture-marker",Et="simple-fill",bt="simple-line",Pt="simple-marker",Ct="text",Lt="Aa",zt=22,L=120,$t=80,I=50,H=225,_t=document.createElement("canvas");function T(e,t,n){const{extent:s}=e;if(!s)return"";const h=s.width||1,i=s.height||1;if(e.type==="polygon"){const c=e.clone();B(c)&&(c.rings=R(c,{minSegmentsPerCurve:128}).rings),ct({originPosition:"upperLeft",scale:[h/t,i/n],translate:[s.xmin,s.ymax]},c,c);let o="";for(let a=0;a<c.rings.length;a++){const p=c.rings[a];for(let u=0;u<p.length;u++){const m=p[u][0],r=p[u][1],l=u===0?"M":"l",k=u===p.length-1?" Z":"";o+=`${o!==""?" ":""}${l}${m.toString()} ${r.toString()}${k}`}}return o}if(e.type==="polyline"){const c=e.clone();B(c)&&(c.paths=R(c,{minSegmentsPerCurve:128}).paths),ut({originPosition:"upperLeft",scale:[h/t,i/n],translate:[s.xmin,s.ymax]},c,c);let o="";for(let a=0;a<c.paths.length;a++){const p=c.paths[a];for(let u=0;u<p.length;u++){const m=p[u][0],r=p[u][1];o+=`${o!==""?" ":""}${u===0?"M":"l"}${m.toString()} ${r.toString()}`}}return o}return""}function K(e,t){const n=_t.getContext("2d"),s=[];t&&(t.weight&&s.push(t.weight),t.size&&s.push(t.size+"px"),t.family&&s.push(t.family)),n.font=s.join(" ");const{width:h,actualBoundingBoxLeft:i,actualBoundingBoxRight:c,actualBoundingBoxAscent:o,actualBoundingBoxDescent:a}=n.measureText(e);return{width:Math.ceil(Math.max(h,i+c)),height:Math.ceil(o+a),x:Math.floor(i),y:Math.floor((o-a)/2)}}function P(e){const t=e?.size;return{width:t!=null&&typeof t=="object"&&"width"in t?w(t.width):null,height:t!=null&&typeof t=="object"&&"height"in t?w(t.height):null}}async function Dt(e,t){const n=t.fill,s=e.color;if(n?.type==="pattern"&&s&&e.type!==J){const h=await pt(n.src,s.toCss(!0));n.src=h,t.fill=n}}async function Bt(e,t,n,s){if(!("font"in e)||!e.font||t.shape.type!=="text")return;try{await dt(e.font)}catch{}const{width:h,height:i}=P(s);if(!/[\uE600-\uE6FF]/.test(t.shape.text)){const{width:c,height:o,x:a,y:p}=K(t.shape.text,{weight:t.font?.weight,size:t.font?.size,family:t.font?.family});n[0]=h??c,n[1]=i??o,t.shape.x=a,t.shape.y=p;let u="angle"in e?e.angle:null;if(s?.rotation!=null&&(u=(u??0)+s.rotation),u){const m=u*(Math.PI/180),r=Math.abs(Math.sin(m)),l=Math.abs(Math.cos(m));n[1]=n[0]*r+n[1]*l}}}function At(e,t,n,s,h){if(e.haloColor!=null&&e.haloSize!=null){h.masking??=n.map(()=>[]);const i=w(e.haloSize);s[0]+=i,s[1]+=i,n.unshift([{...t,fill:null,stroke:{color:e.haloColor,width:2*i,join:"round",cap:"round"}}]),h.masking.unshift([{shape:{type:"rect",x:0,y:0,width:s[0]+2*$,height:s[1]+2*$},fill:[255,255,255],stroke:null},{...t,fill:[0,0,0,0],stroke:null}])}e.backgroundColor==null&&e.borderLineColor==null||(s[0]+=2*$,s[1]+=2*$,n.unshift([{shape:{type:"rect",x:0,y:0,width:s[0],height:s[1]},fill:e.backgroundColor,stroke:{color:e.borderLineColor,width:w(e.borderLineSize)}}]),h.masking?.unshift([]))}function q(e,t){return e>t?"dark":"light"}function Zt(e,t){const n=typeof t?.size=="number"?t?.size:null,s=n!=null?w(n):null,h=t?.maxSize!=null?w(t.maxSize):null;let i="angle"in e?e.angle:null;t?.rotation!=null&&(i=(i??0)+t.rotation);const c=N(e);let o=U(e);Ft(e,245)!=="dark"||t?.ignoreWhiteSymbols||(o={width:.75,...o,color:"#bdc3c7"});let a=null;const p={shape:null,fill:c,stroke:o,offset:[0,0]};o?.width&&(o.width=Math.min(o.width,$t));const u=o?.width||0;let m=t?.size!=null&&(t?.scale==null||t?.scale),r=0,l=0,k=!1;switch(e.type){case Pt:{const f=e.style,{width:g,height:d}=P(t);let v=g===d&&g!=null?g:s??Math.min(w(e.size),h||L);if(t?.useMarkerSymbolSize===!0&&g!==null&&d!==null){const y=Math.min(w(e.size),h||L);v=y>g&&y>d?Math.min(g,d):y}switch(r=v,l=v,f){case"circle":p.shape={type:"circle",cx:0,cy:0,r:.5*v},m||(r+=u,l+=u);break;case"cross":p.shape={type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[r,.5*l]},{command:"M",values:[.5*r,0]},{command:"L",values:[.5*r,l]}]};break;case"diamond":p.shape={type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[.5*r,0]},{command:"L",values:[r,.5*l]},{command:"L",values:[.5*r,l]},{command:"Z",values:[]}]},m||(r+=u,l+=u);break;case"square":p.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[r,0]},{command:"L",values:[r,l]},{command:"L",values:[0,l]},{command:"Z",values:[]}]},m||(r+=u,l+=u),i&&(k=!0);break;case"triangle":p.shape={type:"path",path:[{command:"M",values:[.5*r,0]},{command:"L",values:[r,l]},{command:"L",values:[0,l]},{command:"Z",values:[]}]},m||(r+=u,l+=u),i&&(k=!0);break;case"x":p.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[r,l]},{command:"M",values:[r,0]},{command:"L",values:[0,l]}]},i&&(k=!0);break;case"path":p.shape={type:"path",path:e.path||""},m||(r+=u,l+=u),i&&(k=!0),m=!0}break}case bt:{const{width:f,height:g}=P(t),d=rt(o).reduce((x,M)=>x+M,0),v=d&&Math.ceil(I/d),y=g??s??u,S=f??(d*v||I);if(m=!0,t?.geometry?.type==="polyline"&&t?.geometry?.extent){r=S,l=g??r;const x=1e3,M=.15*x;a=[r,l],l=a[0]>a[1]?x*a[1]/a[0]:x,r=a[0]>a[1]?x:x*a[0]/a[1],o?.width&&(o.width=o.width*x/(a[1]>a[0]?a[1]:a[0]),o.width>M&&(o.width=M)),p.shape={type:"path",path:T(t.geometry,r,l)}}else r=t?.maxSize!=null?Math.min(S,t.maxSize):S,l=y,o&&(o.width=y),p.shape={type:"path",path:[{command:"M",values:[y/2,l/2]},{command:"L",values:[r-y/2,l/2]}]};break}case J:case Et:{const f=typeof t?.symbolConfig=="object"&&!!t?.symbolConfig?.isSquareFill,{width:g,height:d}=P(t);r=!f&&g!==d||g==null?s??zt:g,l=!f&&g!==d||d==null?r:d,m||(r+=u,l+=u),m=!0,t?.geometry?.extent&&t?.geometry?.type==="polygon"?(a=[r,l],l=a[0]>a[1]?1e3*a[1]/a[0]:1e3,r=a[0]>a[1]?1e3:1e3*a[0]/a[1],p.shape={type:"path",path:T(t.geometry,r,l)}):p.shape=f?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[r,0]},{command:"L",values:[r,l]},{command:"L",values:[0,l]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:ot.fill[0];break}case wt:{const f=Math.min(w(e.width),h||L),g=Math.min(w(e.height),h||L),{width:d,height:v}=P(t),y=d===v&&d!=null?d:s??Math.max(f,g),S=e.width/e.height;r=S<=1?Math.ceil(y*S):y,l=S<=1?y:Math.ceil(y/S),p.shape={type:"image",x:-Math.round(r/2),y:-Math.round(l/2),width:r,height:l,src:e.url||""},i&&(k=!0);break}case Ct:{const f=e,g=t?.overrideText||f.text||Lt,d=f.font,{width:v,height:y}=P(t),S=y??s??Math.min(w(d.size),h||L),{width:x,height:M}=K(g,{weight:d.weight,size:S,family:d.family}),E=/[\uE600-\uE6FF]/.test(g);r=v??(E?S:x),l=E?S:M;let C=.5*(E?S:M);E&&(C+=5),p.shape={type:"text",text:g,x:f.xoffset||0,y:f.yoffset||C,align:"middle",alignBaseline:f.verticalAlignment,decoration:d&&d.decoration,rotated:f.rotated,kerning:f.kerning},p.font=d&&{size:S,style:d.style,decoration:d.decoration,weight:d.weight,family:d.family};break}}return{shapeDescriptor:p,size:[r,l],outputSize:a,renderOptions:{node:t?.node,scale:m,opacity:t?.opacity,rotations:[i],useRotationSize:k,cssEffectFilter:t?.cssEffectFilter,ariaLabel:t?.ariaLabel,clipBloomEffect:t?.clipBloomEffect}}}async function Tt(e,t){const{shapeDescriptor:n,size:s,renderOptions:h,outputSize:i}=Zt(e,t);if(!n.shape)throw new ht("symbolPreview: renderPreviewHTML2D","symbol not supported.");await Dt(e,n),await Bt(e,n,s,t);const c=[[n]];if(typeof t?.symbolConfig=="object"&&t?.symbolConfig?.applyColorModulation){const a=.6*s[0];c.unshift([{...n,offset:[-a,0],fill:j(n.fill,-.3)}]),c.push([{...n,offset:[a,0],fill:j(n.fill,.3)}]),s[0]+=2*a,h.scale=!1}e.type==="text"&&At(e,n,c,s,h);const o=lt(c,s,h);if(i&&o){const a=o.nodeName.toLowerCase()==="img"?o:o.firstChild;a.nodeName.toLowerCase()==="svg"&&a.setAttribute("viewBox",`0 0 ${s[0].toString()} ${s[1].toString()}`),a.setAttribute("width",i[0].toString()),a.setAttribute("height",i[1].toString()),i.length>2&&(a.style.setProperty("padding-left",i[2]?.toString()+"px"),a.style.setProperty("padding-right",i[2]?.toString()+"px"),a.style.setProperty("padding-top",i[3]?.toString()+"px"),a.style.setProperty("padding-bottom",i[3]?.toString()+"px"),a.style.setProperty("box-sizing","border-box"))}return o}function Ft(e,t=H){const n=N(e),s=U(e),h=!n||"type"in n?null:new Z(n),i=s?.color?new Z(s?.color):null,c=h?q(F(h),t):null,o=i?q(F(i),t):null;return o?c?c===o?c:t>=H?"light":"dark":o:c}export{Ft as getContrastingBackgroundTheme,Zt as getRenderSymbolParameters,Tt as previewSymbol2D};

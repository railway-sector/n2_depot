import{e as s,m as h,h as y,ap as g,s as u,c as P,az as v}from"./index-B9VIL3e7.js";import{m as E}from"./DynamicLayerView3D-BKP8dzfH.js";import{a as I}from"./ExportWMSImageParameters-UGZ3fvrR.js";import{i as F}from"./timeSupport-D2E-ODX-.js";import"./SubView3D-C8cM8MqG.js";import"./ImageMaterial.glsl-CvYaigl7.js";import"./TriangleMaterial-BnyE3hVB.js";import"./DefaultLayouts-DjizznTj.js";import"./LayerView3D-CvglZQJN.js";import"./LayerView-D9_Pl3yT.js";import"./RefreshableLayerView-B3uUNyfN.js";import"./utils-BJyoDuBg.js";const b=o=>{const n=o;let e=class extends n{initialize(){this.exportImageParameters=new I({layer:this.layer})}destroy(){this.exportImageParameters=g(this.exportImageParameters)}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}get timeExtent(){return F(this.layer,this.view?.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(t,r){const{layer:i}=this;if(!t)throw new u("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:p}=i;if(!p)throw new u("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:p});const m=this.createFetchPopupFeaturesQuery(t);if(!m)return[];const{extent:a,width:c,height:l,x:w,y:f}=m;if(!(a&&c&&l))throw new u("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:a,width:c,height:l});const x=await i.fetchFeatureInfo(a,c,l,w,f);return P(r),x}};return s([h()],e.prototype,"exportImageParameters",void 0),s([h({readOnly:!0})],e.prototype,"exportImageVersion",null),s([h()],e.prototype,"layer",void 0),s([h({readOnly:!0})],e.prototype,"timeExtent",null),e=s([y("esri.views.layers.WMSLayerView")],e),e};let d=class extends b(E){constructor(){super(...arguments),this.type="wms-3d"}initialize(){this.layer.serviceSupportsSpatialReference(this.view.spatialReference)||this.addResolvingPromise(Promise.reject(new u("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view"))),this._updatingHandles.add(()=>this.exportImageParameters?.version,()=>{this._updatingHandles.addPromise(this.refreshDebounced())})}createFetchPopupFeaturesQuery(o){const{subView:n}=this;if(n.type!=="draped")return null;const e=n.findExtentInfoAt(o),t=e.extent,r=new v(t[0],t[1],t[2],t[3],n.spatialReference),i=e.imageSize,p=i.width,m=i.height,a=r.width/p;return{extent:r,width:p,height:m,x:Math.round((o.x-r.xmin)/a),y:Math.round((r.ymax-o.y)/a)}}getFetchOptions(){return{timeExtent:this.timeExtent}}};d=s([y("esri.views.3d.layers.WMSLayerView3D")],d);const H=d;export{H as default};

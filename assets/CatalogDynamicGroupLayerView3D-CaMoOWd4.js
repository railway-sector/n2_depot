import{e,m as a,h as f,ae as g,ey as U,i$ as x,U as O,ex as _,bl as H,iO as w}from"./index-FjkLmFqq.js";import{l as I}from"./LayerView3D-BPXNJxsy.js";import{d as C}from"./LayerView-BgTeTvUs.js";const c=Symbol(),N=$=>{const V=$;let r=class extends V{constructor(...i){super(...i),this.layerViews=new g,this._debouncedUpdate=U(async()=>{const{layer:n,parent:l}=this,d=l?.footprintLayerView;let p=[];const y=this._createQuery();if(y&&d){const{features:m}=await d.queryFeatures(y);this.suspended||(p=m.map(o=>n.acquireLayer(o)))}this.removeHandles(c),this.addHandles(p,c)})}get creatingLayerViews(){return this.view?.layerViewManager.isCreatingLayerViewsForLayer(this.layer)??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some(i=>i.updating)}enableLayerUpdates(){return x([this._updatingHandles.addWhen(()=>this.parent?.footprintLayerView?.dataUpdating===!1,()=>this.updateLayers()),this._updatingHandles.add(()=>[this.layer.maximumVisibleSublayers,this.layer.parent?.orderBy,this.parent?.footprintLayerView?.filter,this.parent?.footprintLayerView?.timeExtent,this.suspended],()=>this.updateLayers()),O(()=>this.removeHandles(c))])}updateLayers(){this.suspended?this.removeHandles(c):this._updatingHandles.addPromise(_(this._debouncedUpdate()).catch(i=>{H.getLogger(this).error(i)}))}_createQuery(){const i=this.parent?.footprintLayerView,n=this.layer?.parent;if(!i||!n||n.destroyed)return null;const{layer:{maximumVisibleSublayers:l},view:{scale:d}}=this;if(!l)return null;const{itemTypeField:p,itemSourceField:y,itemNameField:m,minScaleField:o,maxScaleField:L,objectIdField:v,orderBy:b}=n,F=w(`${o} IS NULL OR ${d} <= ${o} OR ${o} = 0`,`${L} IS NULL OR ${d} >= ${L}`),u=b?.find(h=>h.field&&!h.valueExpression),t=i.createQuery();if(t.returnGeometry=!1,t.num=l,t.outFields=[v,y,m],t.where=w(t.where,F),this.unsupportedItemTypes!=null){const h=`${p} NOT IN (${this.unsupportedItemTypes.map(S=>`'${S}'`)})`;t.where=w(t.where,h)}return u?.field&&(t.orderByFields=[`${u.field} ${u.order==="descending"?"DESC":"ASC"}`],t.outFields.push(u.field)),t}};return e([a({readOnly:!0})],r.prototype,"creatingLayerViews",null),e([a()],r.prototype,"layer",void 0),e([a()],r.prototype,"layerViews",void 0),e([a({readOnly:!0})],r.prototype,"unsupportedItemTypes",void 0),e([a()],r.prototype,"parent",void 0),e([a({readOnly:!0})],r.prototype,"isUpdating",null),r=e([f("esri.views.layers.CatalogDynamicGroupLayerView")],r),r};let s=class extends N(I(C)){constructor(){super(...arguments),this.type="catalog-dynamic-group-3d",this.layerViews=new g}initialize(){this.addHandles([this.enableLayerUpdates()])}};e([a()],s.prototype,"layerViews",void 0),e([a()],s.prototype,"parent",void 0),e([a()],s.prototype,"view",void 0),s=e([f("esri.views.3d.layers.CatalogDynamicGroupLayerView3D")],s);const E=s;export{E as default};
